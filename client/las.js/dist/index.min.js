"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Las=t():e.Las=t()}(this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=10)}([function(e,t,i){"use strict";t.a={MEDIA_INFO:"mediaInfo",MP4_SEGMENT:"mp4Segment",SCRIPT_PARSED:"scriptParsed",LOAD_END:"loadEnd",ERROR:"lasError",LEVEL_SWITCH_FAILED:"levelSwitchFailed",LEVEL_SWITCHING:"levelSwitching",LEVEL_SWITCHED:"levelSwitched",MANIFEST_PARSED:"manifestParsed",FLV_HEAD:"flvHead",REPORT:"report",HEARTBEAT:"heartbeat"}},function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r}));var r;function n(e,t){return t&&0!==t.length||(t=[e],e=""),e="las.js-"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}!function(e){e.LEVEL_ERROR="e",e.LEVEL_WARN="w",e.LEVEL_INFO="i",e.LEVEL_DEBUG="d",e.LEVEL_VERBOSE="v"}(r||(r={}));var s=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case r.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case r.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case r.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case r.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0;break;default:e.ENABLE_ERROR=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.error||console.warn||console.log).apply(console,a)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.warn||console.log).apply(console,a)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.info||console.log).apply(console,a)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.debug||console.log).apply(console,a)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);console.log.apply(console,a)}},e}();s.ENABLE_ERROR=!0,s.ENABLE_WARN=!1,s.ENABLE_INFO=!1,s.ENABLE_DEBUG=!1,s.ENABLE_VERBOSE=!1},function(e,t,i){"use strict";var r,n;i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return n})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e.MSE_ERROR="mseError"}(r||(r={})),function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.LOAD_ERROR_TIMEOUT=11]="LOAD_ERROR_TIMEOUT",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.MANIFEST_ERROR=104]="MANIFEST_ERROR",e[e.NO_VIDEO=105]="NO_VIDEO",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.DEMUX_ERROR=301]="DEMUX_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR"}(n||(n={}))},function(e,t,i){"use strict";var r;i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),function(e){e[e.AUDIO=8]="AUDIO",e[e.VIDEO=9]="VIDEO",e[e.SCRIPT=18]="SCRIPT"}(r||(r={}));var n={FLV_HEAD_LEN:13,FLV_TAG_HEAD_LEN:11,FLV_TAG_SIZE_LEN:4,AVC_KEY_FRAME_CHECK_LEN:2},s=function(){this.tagType=r.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=null}},function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e.INIT="init",e.FLV_HEAD="flvHead",e.SET_CODECS="setCodecs",e.FLUSH="flush",e.APPEND_DATA="appendData",e.LOAD_END="loadEnd",e.DESTROY="destroy",e.SET_EXTRA="setExtra"}(r||(r={}))},function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var d=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function _(e,t,i,r){var n,s,a,o;if(u(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),a=s[t]),void 0===a)a=s[t]=i,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=h(e))>0&&a.length>n&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,o=d,console&&console.warn&&console.warn(o)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=f.bind(r);return n.listener=i,r.wrapFn=n,n}function l(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");d=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var d=n[e];if(void 0===d)return!1;if("function"==typeof d)s(d,this,t);else{var u=d.length,h=v(d,u);for(i=0;i<u;++i)s(h[i],this,t)}return!0},o.prototype.addListener=function(e,t){return _(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return _(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,c(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,c(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,s,a;if(u(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){a=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return l(this,e,!0)},o.prototype.rawListeners=function(e){return l(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){"use strict";var r,n,s=(r=navigator.vendor,n=navigator.userAgent,{isSafari:!(!(r&&r.indexOf("Apple")>-1&&n)||n.match("CriOS")),isFirefox:/firefox/i.test(n),isAndroid:/android/i.test(n)});t.a=s},function(e,t,i){"use strict";var r,n=i(0),s=i(2);!function(e){e.video="video",e.audio="audio"}(r||(r={}));var a={"mp4a.40.2":{1:new Uint8Array([0,200,0,128,35,128]),2:new Uint8Array([33,0,73,144,2,25,0,35,128]),3:new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]),4:new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]),5:new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]),6:new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])},"mp4a.40.5":{1:new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]),2:new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]),3:new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}};function o(e){return 1024e3/e}function d(e,t){return a[e]||(e="mp4a.40.5"),a[e][t]}var u=i(1),h=Math.pow(2,32)-1,_={video:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])},f=new Uint8Array([0,0,0,24,102,116,121,112,105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),c=new Uint8Array([0,0,0,16,115,116,116,115,0,0,0,0,0,0,0,0]),l=new Uint8Array([0,0,0,16,115,116,115,99,0,0,0,0,0,0,0,0]),p=new Uint8Array([0,0,0,16,115,116,99,111,0,0,0,0,0,0,0,0]),v=new Uint8Array([0,0,0,20,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,0]),m=new Uint8Array([0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),g=new Uint8Array([0,0,0,20,118,109,104,100,0,0,0,1,0,0,0,0,0,0,0,0]),y=new Uint8Array([0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0]),E=new Uint8Array([0,0,0,20,98,116,114,116,0,28,156,128,0,45,198,192,0,45,198,192]),b=new Uint8Array([0,0,0,120,109,118,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),S=new Uint8Array([0,0,0,104,116,107,104,100,1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]),R=new Uint8Array([0,0,0,32,116,114,101,120,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),T=new Uint8Array([0,0,0,44,109,100,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,172,68,0,0,0,0,0,0,0,0,85,196,0,0]),L=new Uint8Array([0,0,0,93,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,77,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,41,101,115,100,115,0,0,0,0,3,27,0,1,0,4,19,64,21,0,0,0,0,0,0,0,0,0,0,0,5]),O=new Uint8Array([0,0,0,185,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,169,97,118,99,49,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,2,208,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),w=new Uint8Array([0,0,0,16,112,97,115,112,0,0,0,1,0,0,0,1]),M=function(){function e(){}return e.moov=function(t){var i=f.byteLength+e._getMoovLen(t),r={data:new Uint8Array(i),offset:0};return r.data.set(f,0),r.offset+=f.byteLength,e._writeMoov(r,t),r.data},e.videoMediaSegment=function(t,i,r,n){var s=8+r.mp4Samples.reduce((function(e,t){return e+t.units.reduce((function(e,t){return e+t.byteLength+4}),0)}),0),a=e._getMediaSegmentData(r,s,n);return e._mediaSegmentHead(a,t,i,r,s,n),r.samples.forEach((function(e){e.units.forEach((function(e){var t=e.byteLength;a.data[a.offset]=t>>24&255,a.data[a.offset+1]=t>>16&255,a.data[a.offset+2]=t>>8&255,a.data[a.offset+3]=255&t,a.data.set(e,a.offset+4),a.offset+=4+t})),delete e.units})),a.data},e.audioMediaSegment=function(t,i,r,n){var s=8+r.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),a=e._getMediaSegmentData(r,s,n);return e._mediaSegmentHead(a,t,i,r,s,n),r.mp4Samples.forEach((function(e){a.data.set(e.unit,a.offset),a.offset+=e.unit.byteLength,delete e.unit})),a.data},e._getMoovLen=function(t){var i=t.reduce((function(t,i){return t+e._getTrakLen(i)}),0);return 8+b.byteLength+i+e._getMvexLen(t)},e._writeMoov=function(t,i){var r=e._getMoovLen(i);e._writeBoxHead(t,e.types.moov,r),e._writeMvhd(t,i[0].timescale,i[0].duration),i.forEach((function(i){e._writeTrak(t,i)})),e._writeMvex(t,i)},e._getMoofLen=function(e){return 100+17*e},e._mediaSegmentHead=function(t,i,r,n,s,a){a&&(t.data.set(a),t.offset=a.byteLength),e._writeMoof(t,i,r,n),e._writeBoxHead(t,e.types.mdat,s)},e._getMediaSegmentData=function(t,i,r){var n=e._getMoofLen(t.mp4Samples.length);return{data:new Uint8Array(n+i+(r?r.byteLength:0)),offset:0}},e._writeMvhd=function(e,t,i){i*=t;var r=Math.floor(i/(h+1)),n=Math.floor(i%(h+1)),s=b;s[28]=t>>24&255,s[29]=t>>16&255,s[30]=t>>8&255,s[31]=255&t,s[32]=r>>24,s[33]=r>>16&255,s[34]=r>>8&255,s[35]=255&r,s[36]=n>>24,s[37]=n>>16&255,s[38]=n>>8&255,s[39]=255&n,e.data.set(s,e.offset),e.offset+=b.byteLength},e._writeTkhd=function(e,t){var i=t.id,r=t.duration*t.timescale,n=Math.floor(r/(h+1)),s=Math.floor(r%(h+1)),a=0,o=0;t.hasOwnProperty("width")&&(a=t.width),t.hasOwnProperty("height")&&(o=t.height);var d=S;d[28]=i>>24&255,d[29]=i>>16&255,d[30]=i>>8&255,d[31]=255&i,d[36]=n>>24,d[37]=n>>16&255,d[38]=n>>8&255,d[39]=255&n,d[40]=s>>24,d[41]=s>>16&255,d[42]=s>>8&255,d[43]=255&s,d[96]=a>>8&255,d[97]=255&a,d[100]=o>>8&255,d[101]=255&o,e.data.set(d,e.offset),e.offset+=S.byteLength},e._getTrakLen=function(t){return 8+S.byteLength+e._getMdiaLen(t)},e._writeTrak=function(t,i){var r=e._getTrakLen(i);this._writeBoxHead(t,e.types.trak,r),this._writeTkhd(t,i),this._writeMdia(t,i)},e._getMdiaLen=function(t){return 8+T.byteLength+_[t.type].byteLength+e._getMinfLen(t)},e._writeMdia=function(t,i){var r=e._getMdiaLen(i);this._writeBoxHead(t,e.types.mdia,r),this._writeMdhd(t,i.timescale,i.duration),t.data.set(_[i.type],t.offset),t.offset+=_[i.type].byteLength,this._writeMinf(t,i)},e._writeMdhd=function(e,t,i){i*=t;var r=Math.floor(i/(h+1)),n=Math.floor(i%(h+1)),s=T;s[28]=t>>24&255,s[29]=t>>16&255,s[30]=t>>8&255,s[31]=255&t,s[32]=r>>24,s[33]=r>>16&255,s[34]=r>>8&255,s[35]=255&r,s[36]=n>>24,s[37]=n>>16&255,s[38]=n>>8&255,s[39]=255&n,e.data.set(s,e.offset),e.offset+=s.byteLength},e._getMinfLen=function(t){return t.type===r.audio?8+y.byteLength+m.byteLength+e._getStblLen(t):8+g.byteLength+m.byteLength+e._getStblLen(t)},e._writeMinf=function(t,i){if(this._writeBoxHead(t,e.types.minf,e._getMinfLen(i)),"audio"===i.type)return t.data.set(y,t.offset),t.offset+=y.byteLength,t.data.set(m,t.offset),t.offset+=m.byteLength,void this._writeStbl(t,i);t.data.set(g,t.offset),t.offset+=g.byteLength,t.data.set(m,t.offset),t.offset+=m.byteLength,this._writeStbl(t,i)},e._getStblLen=function(e){return 8+this._getStsdLen(e)+c.byteLength+l.byteLength+v.byteLength+p.byteLength},e._writeStbl=function(t,i){var r=this._getStblLen(i);this._writeBoxHead(t,e.types.stbl,r),this._writeStsd(t,i),t.data.set(c,t.offset),t.offset+=c.byteLength,t.data.set(l,t.offset),t.offset+=l.byteLength,t.data.set(v,t.offset),t.offset+=v.byteLength,t.data.set(p,t.offset),t.offset+=p.byteLength},e._getStsdLen=function(t){return t.type===r.audio?e._getMp4aStsdLen(t):e._getAvc1StsdLen(t)},e._writeStsd=function(e,t){t.type!==r.audio?this._writeAvc1Stsd(e,t):this._writeMp4aStsd(e,t)},e._getAvcCLen=function(e){return 15+e.sps.reduce((function(e,t){return e+t.byteLength+2}),0)+e.pps.reduce((function(e,t){return e+t.byteLength+2}),0)},e._getAvc1Len=function(t){return 86+e._getAvcCLen(t)+20+16},e._getAvc1StsdLen=function(e){return 16+this._getAvc1Len(e)},e._writeAvc1Stsd=function(t,i){var r,n,s,a=[],o=[];for(r=0;r<i.sps.length;r++)s=(n=i.sps[r]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(n));for(r=0;r<i.pps.length;r++)s=(n=i.pps[r]).byteLength,o.push(s>>>8&255),o.push(255&s),o=o.concat(Array.prototype.slice.call(n));var d=this._getAvcCLen(i),u=this._getAvc1Len(i),h=this._getAvc1StsdLen(i),_=O,f=i.width,c=i.height,l=i.pixelRatio[0],p=i.pixelRatio[1];_[0]=h>>24&255,_[1]=h>>16&255,_[2]=h>>8&255,_[3]=255&h,_[16]=u>>24&255,_[17]=u>>16&255,_[18]=u>>8&255,_[19]=255&u,_[48]=f>>8&255,_[49]=255&f,_[50]=c>>8&255,_[51]=255&c,t.data.set(_,t.offset),t.offset+=_.byteLength,this._writeBoxHead(t,e.types.avcC,d);var v=[1,a[3],a[4],a[5],255,224|i.sps.length].concat(a).concat([i.pps.length]).concat(o);t.data.set(v,t.offset),t.offset+=v.length,t.data.set(E,t.offset),t.offset+=E.byteLength;var m=w;m[8]=l>>24,m[9]=l>>16&255,m[10]=l>>8&255,m[11]=255&l,m[12]=p>>24,m[13]=p>>16&255,m[14]=p>>8&255,m[15]=255&p,t.data.set(m,t.offset),t.offset+=m.byteLength},e._getMp4aEsdsLen=function(e){return 33+e.config.length+4},e._getMp4aStsdLen=function(t){return 52+e._getMp4aEsdsLen(t)},e._writeMp4aStsd=function(t,i){var r=i.config.length,n=e._getMp4aEsdsLen(i),s=e._getMp4aStsdLen(i),a=s-16,o=L;o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o[16]=a>>24&255,o[17]=a>>16&255,o[18]=a>>8&255,o[19]=255&a,o[41]=i.channelCount,o[48]=i.samplerate>>8&255,o[49]=255&i.samplerate,o[52]=n>>24&255,o[53]=n>>16&255,o[54]=n>>8&255,o[55]=255&n,o[65]=23+r,o[70]=15+r,t.data.set(o,t.offset),t.offset+=o.byteLength;var d=[r].concat(i.config).concat([6,1,2]);t.data.set(d,t.offset),t.offset+=d.length},e._getMvexLen=function(e){return 8+e.length*R.byteLength},e._writeMvex=function(t,i){var r=e._getMvexLen(i);this._writeBoxHead(t,e.types.mvex,r),i.forEach((function(i){e._writeTrex(t,i)}))},e._writeTrex=function(e,t){var i=t.id,r=R;r[12]=i>>24,r[13]=i>>16&255,r[14]=i>>8&255,r[15]=255&i,e.data.set(r,e.offset),e.offset+=r.byteLength},e._writeMoof=function(t,i,r,n){var s=n.mp4Samples.length,a=e._getMoofLen(s),o=a-24,d=12+s,u=20+16*s,_=a+8,f=n.id,c=n.mp4Samples||[],l=Math.floor(r/(h+1)),p=Math.floor(r%(h+1));e._writeBoxHead(t,e.types.moof,a),e._writeBoxHead(t,e.types.mfhd,16),t.data[t.offset+4]=i>>24,t.data[t.offset+5]=i>>16&255,t.data[t.offset+6]=i>>8&255,t.data[t.offset+7]=255&i,t.offset+=8,e._writeBoxHead(t,e.types.traf,o),e._writeBoxHead(t,e.types.tfhd,16),t.data[t.offset+4]=f>>24,t.data[t.offset+5]=f>>16&255,t.data[t.offset+6]=f>>8&255,t.data[t.offset+7]=255&f,t.offset+=8,e._writeBoxHead(t,e.types.tfdt,20),t.data[t.offset]=1,t.data[t.offset+4]=l>>24,t.data[t.offset+5]=l>>16&255,t.data[t.offset+6]=l>>8&255,t.data[t.offset+7]=255&l,t.data[t.offset+8]=p>>24,t.data[t.offset+9]=p>>16&255,t.data[t.offset+10]=p>>8&255,t.data[t.offset+11]=255&p,t.offset+=12,e._writeBoxHead(t,e.types.sdtp,d),t.offset+=4,c.forEach((function(e,i){var r=e.flags;t.data[t.offset+i]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy})),t.offset+=s,e._writeBoxHead(t,e.types.trun,u),t.data[t.offset+2]=15,t.data[t.offset+3]=1,t.data[t.offset+4]=s>>>24&255,t.data[t.offset+5]=s>>>16&255,t.data[t.offset+6]=s>>>8&255,t.data[t.offset+7]=255&s,t.data[t.offset+8]=_>>>24&255,t.data[t.offset+9]=_>>>16&255,t.data[t.offset+10]=_>>>8&255,t.data[t.offset+11]=255&_,t.offset+=12,c.forEach((function(e,i){t.data.set([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.len>>>24&255,e.len>>>16&255,e.len>>>8&255,255&e.len,e.flags.isLeading<<2|e.flags.dependsOn,e.flags.isDependedOn<<6|e.flags.hasRedundancy<<4|e.flags.isNonSync,61440&e.flags.degradPrio,15&e.flags.degradPrio,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts],t.offset+16*i)})),t.offset+=16*s},e._writeBoxHead=function(e,t,i){e.data[e.offset]=i>>24&255,e.data[e.offset+1]=i>>16&255,e.data[e.offset+2]=i>>8&255,e.data[e.offset+3]=255&i,e.data.set(t,e.offset+4),e.offset+=8},e}();M.types={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stsz:[115,116,115,122],stts:[115,116,116,115],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100],smhd:[115,109,104,100]};var A=M;function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var x=function(){function e(e,t){this.tag="MP4Remuxer",this._eventEmitter=void 0,this._forceFirstIDR=void 0,this._videoTimeReference=void 0,this._videoTimeReferenceInfo=void 0,this._extra=void 0,this._nextAudioPTS=void 0,this._nextVideoDTS=void 0,this._initPTS=void 0,this._videoLastPTS=0,this._audioLastPTS=0,this._videoSampleDuration=40,this._moovs=void 0,this._eventEmitter=e,this._videoTimeReference=!t.gopRemux,this._videoTimeReferenceInfo={},this._forceFirstIDR=navigator.userAgent.toLowerCase().indexOf("chrome")>-1}var t=e.prototype;return t.resetMoov=function(){this._moovs=void 0,this._clearVideoTimeReference()},t.setExtra=function(e){this._extra=e},t.resetTimeStamp=function(){this._initPTS=void 0,this._audioLastPTS=this._videoLastPTS=0},t.getLastPTS=function(){return{video:this._videoLastPTS,audio:this._audioLastPTS}},t.flush=function(){var e,t=this._videoTimeReferenceInfo;return this._videoTimeReference&&t.sample&&(t.track.samples=[t.sample],t.track.sequenceNumber++,t.sample=void 0,e=this._remuxVideo(t.track,!0,!1)),this._clearVideoTimeReference(),e},t.remux=function(e,t,i,r,s){if(void 0===s&&(s=!1),this._moovs||this._initMP4(e,t,i),this._moovs){var a,o;if(e.samples.length&&t.samples.length&&!r&&e.samples[0].pts<t.samples[0].pts){var d=k({},t.samples[0]);d.dts=d.pts=e.samples[0].pts,t.samples.unshift(d)}!r&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),a=this._remuxAudio(e,r),!(o=this._remuxVideo(t,r,!s))&&s&&this._videoTimeReferenceInfo.sample&&(o=this.flush()),o&&!a&&e.codec&&(a=this._fillEmptyAudio(e,r,o.startPTS,o.endPTS,o.streamDTS));var u=[];a&&u.push(a),o&&u.push(o),u.length&&this._eventEmitter.emit(n.a.MP4_SEGMENT,{segments:u,extra:this._extra})}},t._initMP4=function(e,t,i){var r,a=this._eventEmitter,o=e.samples,d=t.samples,u={},h={};if(e.config&&o.length&&(e.timescale=e.samplerate,h.audio=A.moov([e]),u.audioCodec=e.codec,u.channelCount=e.channelCount,u.audioSampleRate=e.samplerate,u.hasAudio=!0,u.defaultAudioCodec=e.defaultCodec,r=o[0].pts-e.inputTimescale*i),t.sps&&t.pps&&d.length){var _=t.inputTimescale;t.timescale=_,h.video=A.moov([t]),u.videoCodec=t.codec,u.width=t.width,u.height=t.height,u.fps=t.fps,u.profile=t.profile,u.level=t.level,u.chromaFormat=t.chromaFormat,u.hasVideo=!0;var f=d[0].pts-_*i,c=d[0].dts-_*i;r=r?Math.min(r,c):f}u.hasAudio||u.hasVideo?(void 0===this._initPTS&&(this._initPTS=r),this._moovs=h,a.emit(n.a.MEDIA_INFO,u)):a.emit(n.a.ERROR,{type:s.b.MUX_ERROR,details:s.a.DEMUX_ERROR,fatal:!1,info:{reason:"no audio/video samples found"}})},t._remuxVideo=function(e,t,i){if(void 0===i&&(i=!0),e.samples.length){var n=this._initPTS,s=e.timescale,a=e.samples,o=0,d=a.length,u=[],h=this._nextVideoDTS;if(void 0!==n&&0!==d&&0!==s){t&&void 0!==h||(h=a[0].dts),a.forEach((function(e){e.pts=e.pts-n,e.dts=e.dts-n})),a.sort((function(e,t){return e.dts-t.dts||e.pts-t.pts})),this._videoTimeReference&&(this._videoTimeReferenceInfo.track=e,this._videoTimeReferenceInfo.sample&&(d++,a.unshift(this._videoTimeReferenceInfo.sample),this._videoTimeReferenceInfo.sample=void 0),a.length>1&&i&&(this._videoTimeReferenceInfo.sample=a.pop(),d--));var _=a[0],f=Math.max(_.dts,0),c=Math.max(_.pts,0);if(t)Math.round(f-h)&&(c=a[0].pts=c-(f-h),f=a[0].dts=f=h);for(var l=0;l<d;l++){var p,v,m=a[l];if(l<d-1){var g=a[l+1];if(g.dts<=m.dts){var y=g.pts-g.dts;g.dts=m.dts+1,g.pts=g.dts+y}o=g.dts-m.dts}else{var E=e.sampleDuration||this._videoSampleDuration;this._videoTimeReferenceInfo.sample&&(E=this._videoTimeReferenceInfo.sample.dts-m.dts),o=Math.floor(E)}v=Math.round(m.pts-m.dts),p=m.units.reduce((function(e,t){return t.byteLength+4+e}),0),u.push({len:p,units:m.units,duration:o,cts:v,streamDTS:m.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:m.key?2:1,isNonSync:m.key?0:1}})}var b=a[a.length-1];this._nextVideoDTS=b.dts+o;var S=b.pts+o;if(u.length&&this._forceFirstIDR){var R=u[0].flags;R.dependsOn=2,R.isNonSync=0}e.mp4Samples=u;var T={payload:A.videoMediaSegment(e.sequenceNumber++,f,e,this._getMoovByType(r.video)),startPTS:c/s,endPTS:S/s,startDTS:f/s,endDTS:this._nextVideoDTS/s,type:r.video,streamDTS:_.streamDTS/s};return this._videoLastPTS=T.endPTS,this._videoSampleDuration=Math.max(o,1),e.samples=[],e.mp4Samples=[],T}}},t._remuxAudio=function(e,t){if(e.samples.length){var i,n=this._initPTS,s=e.inputTimescale,a=s/e.timescale,h=1024*a,_=[],f=0,c=e.samples,l=this._nextAudioPTS,p=o(e.samplerate);if(void 0!==n&&(c.forEach((function(e){e.pts=e.dts=e.pts-n})),t&&void 0!==l||(l=c[0].pts),void 0!==l)){for(var v=0,m=l;v<c.length;v++){var g=c[v],y=g.unit,E=g.pts,b=Math.round(E-m),S=Math.abs(1e3*b/s);if(b<=-h)u.b.v(this.tag,"drop audio frame. pts: "+E);else{if(b>=h&&S<1e5&&m){var R=Math.round(b/h);u.b.v(this.tag,"fill audio frame. count: "+R+" pts: "+E);for(var T=0;T<R;T++){var L=d(e.defaultCodec||e.codec,e.channelCount);L||(u.b.v(this.tag,"fill copy audio frame"),L=y.subarray()),_.push({len:L.byteLength,unit:L,cts:0,duration:1024,streamDTS:Math.round(g.streamDTS-R*p),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0}}),f=f||Math.max(m,0),m+=h}}else f=f||E,m+=h;_.push({len:y.byteLength,cts:0,duration:1024,unit:y,streamDTS:g.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0}}),i=E}}if(_.length&&"number"==typeof i){this._nextAudioPTS=l=i+1024*a,e.mp4Samples=_;var O=A.audioMediaSegment(e.sequenceNumber++,f/a,e,this._getMoovByType(r.audio));e.samples=[],e.mp4Samples=[];var w=f/s,M=l/s,k={payload:O,startPTS:w,endPTS:M,startDTS:w,endDTS:M,type:r.audio,streamDTS:_[0].streamDTS/s};return this._audioLastPTS=k.endPTS,k}e.samples=[],e.mp4Samples=[]}}},t._fillEmptyAudio=function(e,t,i,r,n){u.b.v(this.tag,"fill empty Audio");var s=d(e.defaultCodec||e.codec,e.channelCount);if(void 0!==this._initPTS&&s){for(var a=e.inputTimescale,h=(void 0!==this._nextAudioPTS?this._nextAudioPTS:i*a)+this._initPTS,_=r*a+this._initPTS,f=o(e.samplerate),c=Math.ceil((_-h)/f),l=[],p=0;p<c;p++){var v=h+p*f;l.push({unit:s,pts:v,dts:v,streamDTS:Math.round(n*a+p*f)})}return e.samples=l,this._remuxAudio(e,t)}},t._getMoovByType=function(e){var t;return this._moovs&&this._moovs[e]&&(t=this._moovs[e],delete this._moovs[e]),t},t._clearVideoTimeReference=function(){this._videoTimeReferenceInfo={}},e}(),D=i(3),C=i(6),I=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];function B(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function e(e){this._data=void 0,this._byteIndex=void 0,this._bitIndex=void 0,this._data=e,this._byteIndex=0,this._bitIndex=0}var t,i,r,n=e.prototype;return n.skipBits=function(e){if(this.bitRemaining>e){var t=e%8;this._byteIndex=this._byteIndex+Math.floor(e/8)+Math.floor((this._bitIndex+t)/8),this._bitIndex=(this._bitIndex+t)%8}else this._byteIndex=this._data.byteLength-1,this._bitIndex=7},n.bits=function(e){if(e>32)throw new Error("len must be less 32");var t=this._data[this._byteIndex],i=Math.min(8-this._bitIndex,e),r=e-i;this._bitIndex+=i;var n=t>>8-this._bitIndex&Math.pow(2,i)-1;return 8===this._bitIndex&&(this._bitIndex=0,this._byteIndex++),r?n<<r|this.bits(r):n},n.ue=function(){var e=this._leadingZeroCount();return this.bits(e+1)-1},n.se=function(){var e=this.ue();return Math.pow(-1,e+1)*Math.ceil(e/2)},n._leadingZeroCount=function(){for(var e=this.bitRemaining,t=0;t<e;t++)if(1===this.bits(1))return 0===this._bitIndex?(this._byteIndex--,this._bitIndex=7):this._bitIndex--,t;return 0},t=e,(i=[{key:"bitRemaining",get:function(){return 8*(this._data.byteLength-this._byteIndex)-this._bitIndex}}])&&B(t.prototype,i),r&&B(t,r),e}(),F=[[1,1],[12,11],[10,11],[16,11],[40,33],[24,11],[20,11],[32,11],[80,33],[18,11],[15,11],[64,33],[160,99],[4,3],[3,2],[2,1]],N={1:"4:2:0",2:"4:2:2",3:"4:4:4"},U={66:"Baseline",77:"Main",88:"Extended",100:"High",110:"High10",122:"High422",244:"High444"},V=[100,110,122,244,44,83,86,118,128,138,144],H=function(){function e(){}return e.parse=function(t){for(var i=new Uint8Array(t.byteLength),r=0,n=0;n<t.byteLength;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(i[r]=t[n],r++);var s=new P(i);s.skipBits(8);var a=s.bits(8);s.skipBits(8);var o=s.bits(8);s.ue();var d=1;if(-1!==V.indexOf(a)&&(3===(d=s.ue())&&s.skipBits(1),s.ue(),s.ue(),s.skipBits(1),s.bits(1)))for(var u=3!==d?8:12,h=0;h<u;h++)s.bits(1)&&(h<6?e._skipScalingList(s,16):e._skipScalingList(s,64));s.ue();var _=s.ue();if(0===_)s.ue();else if(1===_){s.bits(1),s.se(),s.se();for(var f=s.ue(),c=0;c<f;c++)s.se()}s.ue(),s.skipBits(1);var l=s.ue(),p=s.ue(),v=s.bits(1);0===v&&s.skipBits(1),s.skipBits(1);var m=0,g=0,y=0,E=0;s.bits(1)&&(m=s.ue(),g=s.ue(),y=s.ue(),E=s.ue());var b=0,S=[1,1];if(s.bits(1)){if(s.bits(1)){var R=s.bits(8);R>0&&R<16?S=F[R-1]:255===R&&(S=[s.bits(8)<<8|s.bits(8),s.bits(8)<<8|s.bits(8)])}if(s.bits(1)&&s.bits(1),s.bits(1)&&(s.bits(4),s.bits(1)&&s.bits(24)),s.bits(1)&&(s.ue(),s.ue()),s.bits(1)){var T=s.bits(32),L=s.bits(32);s.bits(1)&&(b=L/(2*T))}}s=void 0;var O=0,w=0;0===d?(O=1,w=2-v):(O=3===d?1:2,w=(1===d?2:1)*(2-v));var M=16*(l+1),A=16*(p+1)*(2-v);return M-=(m+g)*O,A-=(y+E)*w,{profile:U[a]||"unknown",level:(o/10).toFixed(1),chromaFormat:(d<=3?N[d]:N[1])||"unknown",fps:b,pixelAspectRatio:S,width:M,height:A}},e._skipScalingList=function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.se()+256)%256),i=0===r?i:r},e}();function j(e,t,i){for(var r=new Uint8Array(e,t,i),n=[],s=0,a=r.byteLength;s<a;){if(r[s]<128)n.push(r[s]);else if(r[s]<192);else if(r[s]<224){if(s<a-1&&r[s+1]>>6==2){n.push((31&r[s])<<6|63&r[s+1]),s+=2;continue}}else if(r[s]<240){if(s<a-2&&r[s+1]>>6==2&&r[s+2]>>6==2){n.push((15&r[s])<<12|(63&r[s+1])<<6|63&r[s+2]),s+=3;continue}}else if(r[s]<248&&s<a-3&&r[s+1]>>6==2&&r[s+2]>>6==2&&r[s+3]>>6==2){n.push((7&r[s])<<18|(63&r[s+1])<<12|(63&r[s+2])<<6|63&r[s+3]),s+=4;continue}s++}return String.fromCodePoint.apply(null,n)}var q=function(){function e(){}return e.decode=function(t,i){void 0===i&&(i=0);var r={view:new DataView(t,i),i:0};r.i=0;var n={};try{n[e._read(r)]=e._read(r)}catch(e){}return n},e._read=function(t){var i,r=t.view,n=r.byteLength,s=r.getUint8(t.i);switch(t.i++,s){case 0:return i=r.getFloat64(t.i),t.i+=8,i;case 1:return i=r.getUint8(t.i),t.i++,i;case 2:return e._readString(t);case 3:for(i={};t.i<n-4;){if(e._isObjectEnd(t)){t.i+=3;break}e._readObjProperty(t,i)}return i;case 5:return null;case 8:for(i={},t.i+=4;t.i<n-8;){if(e._isObjectEnd(t)){t.i+=3;break}e._readObjProperty(t,i)}return i;case 10:i=[];var a=r.getUint32(t.i);t.i+=4;for(var o=0;o<a;o++)i.push(e._read(t));return i;case 11:return e._readDate(t);case 12:return e._readLongString(t)}},e._isObjectEnd=function(e){return e.i+2>e.view.byteLength-1||0===e.view.getInt16(e.i)&&9===e.view.getUint8(e.i+2)},e._readObjProperty=function(t,i){var r=e._readString(t),n=e._read(t);i[r]=n},e._readString=function(e){var t,i=e.view.getUint16(e.i);return t=i>0?j(e.view.buffer,e.view.byteOffset+e.i+2,i):"",e.i+=2+i,t},e._readLongString=function(e){var t,i=e.view.getUint32(e.i);return t=i>0?j(e.view.buffer,e.view.byteOffset+e.i+4,i):"",e.i+=4+i,t},e._readDate=function(e){var t=e.view.getFloat64(e.i);e.i+=8;var i=e.view.getInt16(e.i);return e.i+=2,new Date(t+60*i*1e3)},e}(),z=function(){function e(e,t,i){this.tag="FlvDemux",this._eventEmitter=void 0,this._remuxer=void 0,this._naluLengthSize=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._audioLastDTS=0,this._videoLastDTS=0,this._nonMonotonousTagCache=void 0,this._audioCodec="",this._videoCodec="",this._eventEmitter=e,this._remuxer=t,this._naluLengthSize=4,this._hasVideo=!0,this._hasAudio=!0,this._videoTrack={id:1,type:r.video,codec:"",timescale:1e3,duration:0,samples:[],mp4Samples:[],inputTimescale:1e3,sequenceNumber:0,width:0,height:0,codecWidth:0,codecHeight:0,sps:[],pps:[],pixelRatio:[],profile:"",level:"",chromaFormat:"",fps:0,sampleDuration:0},this._audioTrack={id:2,type:r.audio,codec:"",timescale:1e3,duration:0,samples:[],mp4Samples:[],inputTimescale:1e3,sequenceNumber:0,samplerate:0,channelCount:0,config:[],sampleDuration:0}}var t=e.prototype;return t.append=function(e,t,i){var r=this;this._remuxStat||(this._remuxStat={timeOffset:t,isContinuous:i}),e.length&&(e.forEach((function(e){e.tagType===D.c.VIDEO&&r._hasVideo?r._parseVideoData(e):e.tagType===D.c.AUDIO&&r._hasAudio?r._parseAudioData(e):e.tagType===D.c.SCRIPT&&r._parseScriptTag(e)})),this._remux())},t.setCodecs=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this._audioCodec=e,this._videoCodec=t},t.flvHead=function(e,t){this._hasAudio=e,this._hasVideo=t},t.destroy=function(){},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.reset=function(){this._videoTrack.samples=[],this._audioTrack.samples=[],this._audioLastDTS=this._videoLastDTS=0,this._remuxStat=void 0},t._parseScriptTag=function(e){if(e.body){var t=q.decode(e.body.buffer);if(t.timestamp=e.timestamp,t.hasOwnProperty("onMetaData")){var i=t.onMetaData;"number"==typeof i.framerate&&(this._videoTrack.fps=this._videoTrack.fps||i.framerate),u.b.i(this.tag,"Parsed onMetaData")}this._eventEmitter.emit(n.a.SCRIPT_PARSED,t)}},t._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var i=15&t;if(7===i){e.codecId=i;var r=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),0===r)this._parseAVCDecoderConfigurationRecord(e,5);else if(1===r)this._parseAVCVideoData(e,5);else if(2!==r)return void this._onError(s.a.DEMUX_ERROR,"video packet type error: "+r+" ")}else this._onError(s.a.DEMUX_ERROR,"video codec Unsupported: "+i)}},t._parseAVCDecoderConfigurationRecord=function(e,t){if(e.body){var i=this._videoTrack,r=e.body.buffer,n=e.body.byteLength-t,a=new DataView(r,t,n),o=a.getUint8(0),d=a.getUint8(1);if(1===o&&0!==d)if(this._naluLengthSize=1+(3&a.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&a.getUint8(5);if(0===h||h>1)this._onError(s.a.DEMUX_ERROR,"H264 SPS count error: "+h);else{for(var _=6,f=[],c=0;c<h;c++){var l=a.getUint16(_);if(_+=2,0!==l){var p=new Uint8Array(r,t+_,l);_+=l,f.push(p);for(var v=H.parse(p),m=p.subarray(1,4),g="avc1.",y=0;y<3;y++){var E=m[y].toString(16);E.length<2&&(E="0"+E),g+=E}!i.codec||i.width===v.width&&i.height===v.height&&g===i.codec||(this._remux(!0),this._remuxer.resetMoov()),i.sps=f,i.width=v.width,i.height=v.height,i.pixelRatio=v.pixelAspectRatio,v.fps&&(i.fps=v.fps),i.codec=g,i.profile=v.profile,i.level=v.level,i.chromaFormat=v.chromaFormat}}var b=a.getUint8(_);if(0===b||b>1)this._onError(s.a.DEMUX_ERROR,"H264 PPS count error: "+b);else{_++,i.pps=[];for(var S=0;S<b;S++){var R=a.getUint16(_);_+=2;var T=new Uint8Array(r,t+_,R);i.pps.push(T),0!==R&&(_+=R)}u.b.v(this.tag,"Parsed AVCDecoderConfigurationRecord"),i.sampleDuration=Math.floor(i.timescale/(i.fps||25))}}}else this._onError(s.a.DEMUX_ERROR,"nalu length size error: "+this._naluLengthSize);else this._onError(s.a.DEMUX_ERROR,"AVCDecoderConfiguration error")}},t._parseAVCVideoData=function(e,t,i){if(void 0===i&&(i=!1),e.body){var n=e.body.buffer,s=e.body.byteLength-t,a=new DataView(n,t,s),o=[],d=0,h=0,_=this._naluLengthSize,f=e.timestamp,c=1===e.frameType;if(!i&&f<=this._videoLastDTS&&this._videoLastDTS>0)return u.b.w(this.tag,"debug Non-monotonous DTS dts:"+f+" last:"+this._videoLastDTS),void this._onNonMonotonous({tag:e,dataOffset:t},r.video);!i&&this._nonMonotonousTagCache&&this._flushNonMonotonousCache(),i&&f<=this._videoLastDTS&&(f=this._videoLastDTS+1);for(var l=f+e.cts;h<s;){if(h+4>=s){u.b.v(this.tag,"ignore nalu. timestamp = "+e.timestamp+", offset = "+h+", dataSize = "+s);break}var p=a.getUint32(h);if(3===_&&(p>>>=8),p>s-_)return void u.b.v(this.tag,"ignore nalu. naluSize > dataSize timestamp "+f);var v=new Uint8Array(n,t+h+4,_+p-4);7===e.codecId&&5===(31&a.getUint8(h+_))&&(c=!0),o.push(v),d+=v.byteLength,h+=_+p}if(o.length){var m=this._videoTrack,g={units:o,length:d,dts:f,cts:e.cts,pts:l,streamDTS:e.timestamp,key:c};m.samples.push(g)}this._videoLastDTS=f}},t._parseAudioData=function(e,t){var i;if(void 0===t&&(t=!1),e.body)if(e.body.byteLength<=1)u.b.v(this.tag,"audio packet no payload!");else{var n=this._audioTrack,a=e.body[1];if(0!==a)if(1===a){var o=e.body.subarray(2),d=e.timestamp;if(i=1024e3/n.samplerate,this._audioLastDTS>0){d=this._audioLastDTS+i;var h=e.timestamp-d,_=5*i;if(h>_)d=e.timestamp;else if(!t&&h<-_)return void this._onNonMonotonous({tag:e},r.audio)}!t&&this._nonMonotonousTagCache&&this._flushNonMonotonousCache();var f={unit:o,length:o.byteLength,dts:d,pts:d,streamDTS:e.timestamp};this._audioLastDTS=d,n.samples.push(f)}else u.b.v(this.tag,"Unsupported AAC data type "+a);else{if(e.body.byteLength<4)return;var c=function(e,t,i){if(void 0===i&&(i=""),!(e.byteLength<t+3)){var r=e[t+2]>>>3,n=(7&e[t+2])<<1|e[t+3]>>>7,s=n,a=(120&e[t+3])>>>3,o=[];if(i=i||"mp4a.40."+r,!(n<0||n>=I.length||a<0||a>=8))return C.a.isFirefox?n>=6?(r=5,s=n-3):r=2:C.a.isAndroid?r=2:(r=5,"mp4a.40.29"===i||"mp4a.40.5"===i?s=n-3:"mp4a.40.2"===i&&n>=6&&1===a&&(r=2)),o[0]=r<<3|n>>1&7,o[1]=n<<7&128|a<<3,5===r&&(o[1]=o[1]|s>>1&7,o[2]=(1&s)<<7|8,o[3]=0),{config:o,samplerate:I[n],channelCount:a,codec:"mp4a.40."+r,defaultCodec:i}}}(e.body,0,this._audioCodec);c?(n.config=c.config,n.timescale=n.samplerate=c.samplerate,n.channelCount=c.channelCount,n.codec=c.codec,n.defaultCodec=c.defaultCodec,n.sampleDuration=1024e3/n.samplerate):this._onError(s.a.DEMUX_ERROR,"AudioSpecificConfig parse error")}}},t._onNonMonotonous=function(e,t){this._nonMonotonousTagCache||(this._nonMonotonousTagCache={video:[],audio:[]});var i=this._nonMonotonousTagCache[t];if(i.length>10){this._remuxer.flush();var r=this._remuxer.getLastPTS(),n=r.audio;(0===n||r.video>0&&r.video<n)&&(n=r.video),this._videoTrack.samples=[],this._audioTrack.samples=[],this._audioLastDTS=this._videoLastDTS=0,this._remuxStat={isContinuous:!1,timeOffset:n},this._remuxer.resetMoov(),this._remuxer.resetTimeStamp(),u.b.i(this.tag,"NON_MONOTONOUS reset time"),this._flushNonMonotonousCache()}else i.push(e)},t._flushNonMonotonousCache=function(){if(this._nonMonotonousTagCache){var e=this._nonMonotonousTagCache;for(var t in e)for(var i=e[t];i.length;){var r=i.shift();r&&("video"===t?this._parseAVCVideoData(r.tag,r.dataOffset||0,!0):"audio"===t&&this._parseAudioData(r.tag,!0))}this._nonMonotonousTagCache=void 0}},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack,r=!0,n=0;if(this._remuxStat&&(r=this._remuxStat.isContinuous,n=this._remuxStat.timeOffset),0!==t.samples.length||0!==i.samples.length){if(e||!(this._hasAudio&&0===t.samples.length||this._hasVideo&&i.samples.length<2))try{this._remuxer.remux(t,i,n,r,e),this._remuxStat=void 0}catch(e){u.b.e(this.tag,e),this._onError(s.a.REMUX_ERROR,e.message)}}else e&&this._remuxer.flush()},t._onError=function(e,t){this._eventEmitter.emit(n.a.ERROR,{type:s.b.MUX_ERROR,details:e,fatal:!0,info:{reason:t}})},e}(),W=function(){function e(e,t,i){this.tag="Flv",this._eventEmitter=void 0,this._config=void 0,this._extraData=void 0,this._demuxer=void 0,this._remuxer=void 0,this._eventEmitter=e,this._config=t,this._extraData=i}var t=e.prototype;return t.init=function(){var e=this._config,t=this._eventEmitter,i=this._remuxer=new x(t,e);this._demuxer=new z(t,i,e),i.setExtra(this._extraData)},t.setCodecs=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this._demuxer.setCodecs(e,t)},t.flvHead=function(e,t){this._demuxer.flvHead(e,t)},t.append=function(e,t,i){i||(this._demuxer.reset(),this._remuxer.resetMoov(),this._remuxer.resetTimeStamp()),this._demuxer.append(e,t,i)},t.end=function(){this._demuxer.flush(),this._remuxer.flush(),this._eventEmitter.emit(n.a.LOAD_END)},t.flush=function(){this._demuxer&&this._demuxer.flush()},t.setExtra=function(e){this._extraData=e,this._remuxer&&this._remuxer.setExtra(this._extraData)},t.destroy=function(){},e}();t.a=W},function(e,t,i){function r(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var r=i(i.s=ENTRY_MODULE);return r.default||r}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var a=t.toString(),o=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return s;for(var d,u=o[1],h=new RegExp("(\\\\n|\\W)"+n(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");d=h.exec(a);)"dll-reference"!==d[3]&&s[r].push(d[3]);for(h=new RegExp("\\("+n(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");d=h.exec(a);)e[d[2]]||(s[r].push(d[1]),e[d[2]]=i(d[1]).m),s[d[2]]=s[d[2]]||[],s[d[2]].push(d[4]);for(var _,f=Object.keys(s),c=0;c<f.length;c++)for(var l=0;l<s[f[c]].length;l++)_=s[f[c]][l],isNaN(1*_)||(s[f[c]][l]=1*s[f[c]][l]);return s}function a(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:i.m},o=t.all?{main:Object.keys(n.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};a(i);)for(var o=Object.keys(i),d=0;d<o.length;d++){var u=o[d],h=i[u].pop();if(n[u]=n[u]||{},!n[u][h]&&e[u][h]){n[u][h]=!0,r[u]=r[u]||[],r[u].push(h);for(var _=s(e,e[u][h],u),f=Object.keys(_),c=0;c<f.length;c++)i[f[c]]=i[f[c]]||[],i[f[c]]=i[f[c]].concat(_[f[c]])}}return r}(n,e),d="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),d=d+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([d],{type:"text/javascript"});if(t.bare)return u;var h=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),_=new window.Worker(h);return _.objectURL=h,_}},function(e,t,i){"use strict";i.r(t);var r=i(5),n=i(0),s=i(4),a=i(1),o=i(7);t.default=function(e){var t,i=new r.EventEmitter;i.on(n.a.MEDIA_INFO,(function(t){e.postMessage({event:n.a.MEDIA_INFO,data:t})})),i.on(n.a.ERROR,(function(t){e.postMessage({event:n.a.ERROR,data:t})})),i.on(n.a.SCRIPT_PARSED,(function(t){e.postMessage({event:n.a.SCRIPT_PARSED,data:t})})),i.on(n.a.LOAD_END,(function(t){e.postMessage({event:n.a.LOAD_END,data:t})})),i.on(n.a.MP4_SEGMENT,(function(t){var i={event:n.a.MP4_SEGMENT,data:t},r=[];t.segments.forEach((function(e){r.push(e.payload.buffer)})),e.postMessage(i,r)})),e.addEventListener("message",(function(e){var r=e.data;switch(r.cmd){case s.a.INIT:a.b.level(r.config.debug),function(e,i,r){(t=new o.a(e,i,r)).init()}(i,r.config,r.data);break;case s.a.DESTROY:t&&t.destroy(),i&&i.removeAllListeners();break;case s.a.APPEND_DATA:t.append(r.tags,r.timeOffset,r.isContinuous);break;case s.a.SET_CODECS:t.setCodecs(r.audioCodec,r.videoCodec);break;case s.a.FLV_HEAD:t.flvHead(r.hasAudio,r.hasVideo);break;case s.a.FLUSH:t.flush();break;case s.a.SET_EXTRA:t.setExtra(r.data);break;case s.a.LOAD_END:t.end()}}))}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return ae}));var r=i(5),n=i(1);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var a={webWorker:!0,appendErrorMaxRetry:3,credentials:!1,defaultLiveDelay:-2e3,debug:n.a.LEVEL_ERROR,connectionTimeout:1e4,transmissionTimeout:3e4,autoRecoverMedia:!1,autoPlaybackRate:!0},o=function(){function e(){}return e.processConfig=function(e){var t=s({},a);return s(t,e),window.Worker||(t.webWorker=!1),t.debug&&n.b.level(t.debug),this._initPlayBackRateRule(t),t},e._initPlayBackRateRule=function(e){var t=e.autoPlaybackRateConf;if(t){var i=t.rule;if(i&&Array.isArray(i)&&((i=i.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),i.length>1))return t.rule=i,void(e.autoPlaybackRateConf=t)}else{var r=-e.defaultLiveDelay/1e3,n={startDelay:r,interval:.2,rule:[{rate:1.1,lower:r+1,upper:Number.MAX_SAFE_INTEGER},{rate:1,lower:0,upper:r}]};e.autoPlaybackRateConf=n}},e}(),d=i(2),u=i(0),h=i(8),_=i.n(h);function f(e,t){if(void 0===t)return e;var i=e.split("?");return i.splice(1,0,"?startPts="+t+(i.length>1?"&":"")),i.join("")}var c=function(e){this.url=void 0,this.bitrate=0,this.maxBitrate=0,this.avgBitrate=0,this.qualityType="",this.qualityTypeName="",this.id=0,this.codec="",this.audioCodec="",this.videoCodec="",this.hidden=!1,this.disabledFromAdaptive=!1,this.defaultSelected=!1,this.url=e};function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p,v=function(){function e(t){var i=this;this._levels=[],this._abrLevels=[],this._default=void 0,e.verify(t)&&(t.adaptationSet[0].representation.forEach((function(e,t){var r,n,s=new c(e.url);if(s.id=e.id||0,s.maxBitrate=e.maxBitrate||0,s.avgBitrate=e.avgBitrate||0,s.bitrate=e.avgBitrate||s.maxBitrate,s.qualityType=e.qualityType||"",s.qualityTypeName=e.qualityTypeName||"",s.codec=e.codec||"",s.codec){var a=(r=s.codec,n={},(r||"").split(/[ ,]+/).forEach((function(e){0===e.indexOf("avc1")&&(n.video=e),0===e.indexOf("mp4a")&&(n.audio=e)})),n);s.audioCodec=a.audio,s.videoCodec=a.video}s.hidden=e.hidden||!1,s.disabledFromAdaptive=e.disabledFromAdaptive||e.disabledFromAdaptive,s.defaultSelected=e.defaultSelected||!1,i._levels.push(s),s.disabledFromAdaptive||i._abrLevels.push(t),s.defaultSelected&&void 0===i._default&&(i._default=t)})),this._levels.sort((function(e,t){return e.bitrate-t.bitrate})))}var t,i,r;return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&Array.isArray(e.adaptationSet)&&e.adaptationSet.length>0)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},t=e,(i=[{key:"levels",get:function(){return this._levels}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"default",get:function(){return this._default||0}}])&&l(t.prototype,i),r&&l(t,r),e}(),m=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupport=function(){return!(!self.fetch||!self.ReadableStream)};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var r=new Headers;e.headers&&e.headers.forEach((function(e){r.append(e.header,e.value)}));var n={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.credentials&&(n.credentials="include"),fetch(e.url,n).then((function(t){if(e.responseUrl=t.url,e.responseHeader=t.headers,i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var r=new Error(t.status+" "+t.statusText);i._onError(r)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var r=i.value.buffer;return t._onProgress(t._context,r),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();!function(e){e.MOZ_CHUNK="moz-chunked-arraybuffer",e.MS_STREAM="ms-stream",e.UNKNOW="unknow",e.UNSUPPORT=""}(p||(p={}));var g,y=function(){function e(){this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._reader=null,this._msBufferOffset=0,this._msBufferUpper=16777216,this._progress=p.UNKNOW,this._xhr=null,this._msBufferOffset=0}e.isSupportChunk=function(){if(e.supportChunk!==p.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=p.MOZ_CHUNK,t.responseType===p.MOZ_CHUNK)return e.supportChunk=p.MOZ_CHUNK,e.supportChunk}catch(t){e.supportChunk=p.UNSUPPORT}try{var i=new XMLHttpRequest;if(i.open("GET","https://example.com",!0),i.responseType=p.MS_STREAM,i.responseType===p.MS_STREAM)return e.supportChunk=p.MS_STREAM,e.supportChunk}catch(t){e.supportChunk=p.UNSUPPORT}return p.UNSUPPORT};var t=e.prototype;return t.load=function(t,i){if(this._callbacks=i,this._context=t,this._progress=p.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk(),this._progress===p.MS_STREAM)){var r=this._reader=new self.MSStreamReader;r.onprogress=this._msrOnProgress.bind(this),r.onload=this._onLoadEnd.bind(this),r.onerror=this._onError.bind(this)}var n=this._xhr=new XMLHttpRequest;n.open("GET",this._context.url,!0),this._progress===p.MOZ_CHUNK?(n.responseType=p.MOZ_CHUNK,n.onprogress=this._onProgress.bind(this),n.onload=this._onLoadEnd.bind(this)):this._progress===p.MS_STREAM?n.responseType=p.MS_STREAM:(n.responseType=t.responseType||"arraybuffer",n.onload=this._onLoadEnd.bind(this)),n.onreadystatechange=this._onReadyStateChange.bind(this),n.onerror=this._onError.bind(this),n.withCredentials=!!t.credentials,n.send()},t.abort=function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},t._onReadyStateChange=function(e){if(this._xhr){var t=this._xhr;2===t.readyState?(this._context.responseUrl=t.responseURL,this._context.responseHeader=t.getAllResponseHeaders(),this._callbacks&&this._callbacks.onConnect&&this._callbacks.onConnect(t.status),(t.status<200||t.status>299)&&this._onError(new Error("xhr error"))):3===t.readyState&&this._reader&&0===this._reader.readyState&&t.status>=200&&t.status<=299&&this._reader.readAsArrayBuffer(t.response)}},t._onProgress=function(e){if(this._xhr){var t=this._xhr.response;this._callbacks&&this._callbacks.onProgress&&t&&this._callbacks.onProgress(t)}},t._msrOnProgress=function(e){var t=e.target.result;if(t){var i=t.slice(this._msBufferOffset);this._msBufferOffset=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(i),t.byteLength>=this._msBufferUpper&&this._onError(new Error("ms buffer too large"))}else this._onError(new Error("ms buffer null"))},t._onLoadEnd=function(e){var t=null,i=this._xhr;!this._progress&&i&&(t=i.response),this._callbacks&&this._callbacks.onEnd(t)},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},e}();function E(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}y.supportChunk=p.UNKNOW;var b=function(){function e(){var e=this;this.tag="loader",this._context=void 0,this._loader=void 0,this._callbacks=void 0,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._progressTime=0,this._onConnect=function(t){e._requestTimeout&&(clearTimeout(e._requestTimeout),e._requestTimeout=null),e._startTransmissionTimer(),e._stats.httpStatusCode=t,e._stats.firstDataTime=Math.max(e._stats.requestStartTime,performance.now())},this._onProgress=function(t){var i=e._stats;e._progressTime=performance.now(),e._callbacks&&e._callbacks.onProgress&&e._callbacks.onProgress(e,t),i.loadedSize+=t.byteLength},this._onEnd=function(t){e._stopTimer();var i=e._stats;i.totalSize=t?i.loadedSize="string"==typeof t?t.length||0:t.byteLength||0:i.loadedSize,i.loadedTime=Math.max(i.firstDataTime,performance.now()),e._loading=!1,e._callbacks&&e._callbacks.onEnd(e,t)},this._onError=function(t){n.b.i(e.tag,t),e._stopTimer(),e._destroyInternalLoader();var i=e._stats,r=e._config;e._loading=!1,i.fatalError=!r.maxRetry||i.retryCount>=r.maxRetry||!r.maxRetry,i.errorMessage=t.message||"load error",e._callbacks&&e._callbacks.onError&&e._callbacks.onError(e),i.fatalError||(i.retryCount++,e._callbacks&&(e._retryDelay?(e._retryTimeout=setTimeout(e._loadInternal.bind(e),e._retryDelay),e._retryDelay=2*e._retryDelay):e._loadInternal()))},this._onTimeout=function(){e._loading=!1,e._abortInternal();var t=new Error("timeout");e._onError(t)},this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect,onProgress:this._onProgress,onEnd:this._onEnd,onError:this._onError}}var t,i,r,s=e.prototype;return s.load=function(e,t,i){this._context=e,this._callbacks=t,this._config=i||this._config,this._stats={requestStartTime:performance.now(),retryCount:0,loadedSize:0,httpStatusCode:0,firstDataTime:0,loadedTime:0,totalSize:0,errorMessage:"",fatalError:!1},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay),this._loadInternal()},s.abort=function(){this._stopTimer(),this._abortInternal()},s.destroy=function(){this._stopTimer(),this._abortInternal(),this._destroyInternalLoader(),this._callbacks=void 0},s._getInternalLoader=function(e){return void 0!==g||(g=null,m.isSupport()?g=m:y.isSupportChunk()&&(g=y)),g},s._destroyInternalLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},s._loadInternal=function(){this._loading=!0,this._aborted=!1;var e=this._stats;e.httpStatusCode=0,e.firstDataTime=0,e.loadedSize=0,this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._context.progress?this._loader=new(this._getInternalLoader(!!this._config.useFetch)):this._loader=new y,this._loader&&(this._config.connectionTimeout&&(this._requestTimeout=setTimeout(this._onTimeout,this._config.connectionTimeout)),this._loader.load(this._context,this._loaderCallback))},s._abortInternal=function(){this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this),this._aborted=!0,this._loader&&this._loader.abort()},s._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},s._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},s._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},t=e,(i=[{key:"stats",get:function(){return this._stats}},{key:"context",get:function(){return this._context}}])&&E(t.prototype,i),r&&E(t,r),e}(),S=function(){function e(){var e=this;this._context=void 0,this._result=void 0,this._callback=void 0,this._loader=void 0,this._loaderConf=void 0,this._loaderCallbacks=void 0,this._timer=void 0,this._startTime=0,this._testEnd=function(){e._stopTimer(),e._loader&&e._loader.destroy(),e._context&&e._result&&e._callback&&(e._result.firstPackageDuration=Math.round(e._result.firstPackageDuration),e._result.duration=Math.round(performance.now()-e._startTime),e._callback.onEnd(e._context,e._result))},this._onProgress=function(t,i){e._result&&(e._result.firstPackageDuration=t.stats.firstDataTime?t.stats.firstDataTime-t.stats.requestStartTime:0,e._result.loaded=t.stats.loadedSize)},this._onLoaderError=function(){e._result&&(e._result.succeeded=!1),e._testEnd()},this._onLoaderEnd=function(){e._testEnd()},this._onAbort=function(){},this._loaderConf={connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0,useFetch:!0},this._loaderCallbacks={onProgress:this._onProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd,onAbort:this._onAbort}}var t=e.prototype;return t.start=function(e,t){this._context=e,this._callback=t,this._result={loaded:0,duration:0,firstPackageDuration:0,succeeded:!0},this._startTime=performance.now(),this._loader&&this._loader.destroy();var i=Math.min(1e4,e.timeout);this._loaderConf.connectionTimeout=i;var r={url:e.url,progress:!0,responseType:"arraybuffer"};this._loader=new b,this._startTimer(i),this._loader.load(r,this._loaderCallbacks,this._loaderConf)},t.cancel=function(){this._stopTimer(),this._loader&&this._loader.destroy()},t.destroy=function(){this.cancel()},t._startTimer=function(e){var t=this;this._timer=setTimeout((function(){return t._testEnd()}),e)},t._stopTimer=function(){clearTimeout(this._timer)},e}();function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function T(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L={stableBufferDiffThresholdSecond:.15,stableBufferIntervalMs:2e3,speedTestTimeoutMs:500,generateSpeedGapMs:3e3,bufferCheckIntervalMs:500,smoothedSpeedUtilizationRatio:.8,smallSpeedToBitrateRatio:.4,enoughSpeedToBitrateRatio:.9,bufferLowerLimitSecond:.6,recentBufferedSize:16,smoothedSpeedRatio:.9,isSpeedFullyUsed:!0},O=function(e){var t,i;function r(){var t;return(t=e.call(this)||this)._conf=void 0,t._pastBuffer=void 0,t._levels=void 0,t._current=0,t._next=0,t._stableBufferStartTime=performance.now(),t._speedTester=new S,t._generatedSpeed=0,t._lastCheckBuffer=0,t._lastSpeed=0,t._timer=void 0,t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s,a,o,d=r.prototype;return d.init=function(e,t,i){var r=this;this._conf=R({},L),R(this._conf,i),n.b.i("algorithm-simple","init",e,i,this._conf),this._levels=e.levels.slice(0),this._next=e.default,this._pastBuffer=[.1],t&&(this._timer=setInterval((function(){r._checkBuffer(t)}),this._conf.bufferCheckIntervalMs))},d._updateStableBuffer=function(e){var t=e-this._lastCheckBuffer,i=t/e,r=performance.now();return(t<-this._conf.stableBufferDiffThresholdSecond||i<-.2)&&(n.b.v("algorithm-simple","bufferDiffDown: "+t.toFixed(2)+"s, diffRatio: "+i.toFixed(2)),this._stableBufferStartTime=Math.max(r,this._stableBufferStartTime)),t>this._conf.stableBufferDiffThresholdSecond&&r-this._stableBufferStartTime+this._conf.bufferCheckIntervalMs>this._conf.stableBufferIntervalMs&&(this._stableBufferStartTime=Math.max(r-2*this._conf.bufferCheckIntervalMs,this._stableBufferStartTime+2*this._conf.bufferCheckIntervalMs),n.b.v("algorithm-simple","bufferDiffUp: "+t.toFixed(2)+"s")),this._lastCheckBuffer=e,r-this._stableBufferStartTime>this._conf.stableBufferIntervalMs},d._isSpeedFullyUsed=function(){return this._conf.isSpeedFullyUsed},d._checkBuffer=function(e){var t=e.bufferedSec(),i=this._updateStableBuffer(t);this._isSpeedFullyUsed()?i&&this._current+1<this._levels.length?this._generatedSpeed=this._levels[this._current+1].bitrate:this._generatedSpeed=0:i&&this._current+1<this._levels.length&&(this._startTesting(e),this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),this._pastBuffer.push(t),this._pastBuffer.length>this._conf.recentBufferedSize&&this._pastBuffer.shift()},d._startTesting=function(e){var t=this;n.b.v("algorithm-simple","start speed testing on index: "+(this._current+1));var i=e.downloadSize(),r=this._levels[this._current+1].bitrate;this._speedTester.start({url:this._levels[this._current+1].url,timeout:this._conf.speedTestTimeoutMs},{onEnd:function(s,a){var o=e.downloadSize()-i;if(a.succeeded&&a.duration>0&&a.firstPackageDuration>0){var d=8*(o+a.loaded)/a.duration;n.b.v("algorithm-simple","testSpeed: "+d.toFixed(0)),d>=r&&(t._generatedSpeed=r)}n.b.v("algorithm-simple","succeeded: "+a.succeeded+", firstPackageDuration: "+a.firstPackageDuration+", originalDownloadSize: "+o+", downloadSize: "+a.loaded+", downloadTime: "+a.duration)}})},d.setAvailableBitrates=function(e){},d.onGOP=function(e,t,i){var r=t/Math.max(i,.05)*8/1024;n.b.v("algorithm-simple","buffered: "+e.toFixed(2)+", size: "+t+", time: "+i.toFixed(2)),this._next=this._nextRateIndex(r,e)},d.onLevelLoad=function(e){this._current=Math.max(0,e)},d.destroy=function(){this._speedTester.destroy(),clearInterval(this._timer)},d._quantization=function(e){for(var t=0,i=this._levels.length-1;i>=0;i--)if(e>=this._levels[i].bitrate){t=i;break}return t},d._nextRateIndex=function(e,t){var i=this._nextRateBySpeedAndBuffered(e,t);return i!=this._current&&(this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),i<this._current?(this._speedTester.cancel(),this._generatedSpeed=0,this._lastSpeed=e,this._pastBuffer=[t]):this._lastSpeed=this._getSmoothedSpeed(e),i},d._getSmoothedSpeed=function(e){return this._lastSpeed>0?e*(1-this._conf.smoothedSpeedRatio)+this._lastSpeed*this._conf.smoothedSpeedRatio:e},d._getPredictedBuffer=function(e){return e+(e-Math.max.apply(Math,this._pastBuffer))},d._getBufferSpeed=function(e){var t=Math.max.apply(Math,this._pastBuffer);return(1+(e-t)/t)*this._levels[this._current].bitrate},d._isSpeedTooSmall=function(e){return e/this._levels[this._current].bitrate<this._conf.smallSpeedToBitrateRatio},d._isSpeedEnough=function(e){return e/this._levels[this._current].bitrate>this._conf.enoughSpeedToBitrateRatio},d._nextRateBySpeedAndBuffered=function(e,t){var i=this._getBufferSpeed(t),r=this._getSmoothedSpeed(e);n.b.v("algorithm-simple","gopSpeed: "+e.toFixed(0)+", smoothedSpeed: "+r.toFixed(0));var s=this._getPredictedBuffer(t);n.b.v("algorithm-simple","bufferSpeed: "+i.toFixed(0)+", predictedBuffered: "+s.toFixed(1));var a=this._current;return s<this._conf.bufferLowerLimitSecond||this._isSpeedTooSmall(i)?a=Math.min(this._current,this._quantization(i)):this._isSpeedEnough(i)&&(this._generatedSpeed>0?(n.b.i("algorithm-simple","generatedSpeed used"),a=this._quantization(this._generatedSpeed),this._generatedSpeed=0):a=this._quantization(r*this._conf.smoothedSpeedUtilizationRatio),a=Math.min(this._current+1,Math.max(a,this._current))),a},s=r,(a=[{key:"nextLevel",get:function(){return n.b.v("algorithm-simple","nextLevel: "+this._next),this._next}}])&&T(s.prototype,a),o&&T(s,o),r}(r.EventEmitter);function w(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(e,t,i,r){var n=this;this._eventEmitter=void 0,this._config=void 0,this._media=void 0,this._next=0,this._downloadSizeTotal=0,this._downloadSize=0,this._downloadStartTime=0,this._keyCount=0,this._index=0,this._alg=void 0,this._manifest=void 0,this._autoLevelEnabled=!1,this._eventEmitter=e,this._config=t,this._media=i,this._manifest=new v(r);var s={bufferedSec:function(){return n._media.bufferedSec()},downloadSize:function(){return n._downloadSizeTotal}};this._alg=new O,this._alg.init(this._manifest,s),this._autoLevelEnabled=this._manifest.abrLevels.length>0}var t,i,r,n=e.prototype;return n.init=function(){this._downloadSizeTotal=0,this._downloadSize=0,this._downloadStartTime=performance.now(),this._keyCount=0,this._index=this._next=0,this.current&&(this._autoLevelEnabled&&(this._index=this._next=this._alg.nextLevel),this._eventEmitter.emit(u.a.MANIFEST_PARSED,{levels:this._manifest.levels,currentLevel:this._index}))},n.destory=function(){this._alg&&(this._alg.destroy(),this._alg.removeAllListeners())},n.onLoaderChunk=function(e){this._downloadSize+=e,this._downloadSizeTotal+=e},n.onLevelLoad=function(e){this._manifest.levels.length&&e>=0&&e<this._manifest.levels.length&&(this._keyCount=0,this._index=e,this._downloadStartTime=performance.now(),this._downloadSize=0,this._alg.onLevelLoad(e))},n.onKeyFrame=function(e){var t=this._manifest.levels;if(this._keyCount++,(this._alg||this._next!==this._index)&&this._keyCount>1&&t){var i=this._index;if(this._next!==this._index)i=this._next;else{if(!this._autoLevelEnabled)return;var r=performance.now();this._alg.onGOP(this._media.bufferedSec(),this._downloadSize,(r-this._downloadStartTime)/1e3),this._downloadSize=0,this._downloadStartTime=r,this._next=i=this._alg.nextLevel}if(i!==this._index)return{url:this._getRequestUrl(i,e),level:i,timestamp:e}}},n._getRequestUrl=function(e,t){var i="",r=this._manifest.levels[e];return r&&(i=r.url),f(i,t||this._config.defaultLiveDelay)},t=e,(i=[{key:"autoLevelEnabled",get:function(){return this._autoLevelEnabled}},{key:"levels",get:function(){return this._manifest.levels}},{key:"nextLevel",get:function(){return"number"==typeof this._next?this._next:this._index},set:function(e){e>=0&&this._manifest.levels.length>e?(this._autoLevelEnabled=!1,this._next=e):-1===e&&(this._autoLevelEnabled=!0)}},{key:"currentLevel",get:function(){return this._index},set:function(e){e>=0&&this._manifest.levels.length>e?(this._autoLevelEnabled=!1,this._index=this._next=e):-1===e&&(this._autoLevelEnabled=!0)}},{key:"current",get:function(){return this._manifest.levels[this._index]}}])&&w(t.prototype,i),r&&w(t,r),e}(),A=i(7);function k(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t){void 0===t&&(t=0),this._size=void 0,this._readOffset=0,this._writeOffset=0,this._storage=void 0,this._cache=void 0,this._size=t>0?t:e.DEFAULT_CACHE_SIZE,this._storage=new ArrayBuffer(this._size),this._cache=new Uint8Array(this._storage)}var t,i,r,n=e.prototype;return n.put=function(e){if(this._readOffset===this._writeOffset&&(this._readOffset=this._writeOffset=0),this._writeOffset+e.byteLength>this._size){var t=this._writeOffset+e.byteLength-this._readOffset;t>this._size?(this._collateCache(),this.expandCache(t)):this._collateCache()}this._cache.set(e,this._writeOffset),this._writeOffset+=e.byteLength},n.get=function(e){if(e+this._readOffset>this._writeOffset)return null;var t=null;if(this._cache.slice)t=this._cache.slice(this._readOffset,this._readOffset+e);else{var i=this._cache.byteOffset+this._readOffset;t=new Uint8Array(this._storage.slice(i,i+e))}return this._readOffset+=e,t},n.read=function(e){return e+this._readOffset>this._writeOffset?null:new Uint8Array(this._storage,this._readOffset,e)},n.skip=function(e){e+this._readOffset>this._writeOffset||(this._readOffset+=e)},n.clear=function(){this._readOffset=this._writeOffset=0},n.expandCache=function(t){if(void 0===t&&(t=0),this._size=Math.max(2*this._size,t),this._size>=e.MAX_CACHE_SIZE)throw new Error("max cache size");0===this._readOffset&&0===this._writeOffset?this._storage=new ArrayBuffer(this._size):this._storage=this._transfer(this._storage,this._size),this._cache=new Uint8Array(this._storage)},n._collateCache=function(){var e=new Uint8Array(this._storage,this._readOffset,this._writeOffset-this._readOffset);this._cache.set(e),this._writeOffset-=this._readOffset,this._readOffset=0},n._transfer=function(e,t){if(!(e instanceof ArrayBuffer))throw new TypeError("Source must be an instance of ArrayBuffer");if(t<=e.byteLength)return e.slice(0,t);var i=new Uint8Array(e),r=new Uint8Array(new ArrayBuffer(t));return r.set(i),r.buffer},t=e,(i=[{key:"unreadLen",get:function(){return this._writeOffset-this._readOffset}}])&&k(t.prototype,i),r&&k(t,r),e}();x.MAX_CACHE_SIZE=104857600,x.DEFAULT_CACHE_SIZE=3145728;var D=x,C=i(3),I=function(){function e(e,t){this._eventEmitter=void 0,this._cache=void 0,this._tag=void 0,this._result=void 0,this._parseLen=0,this._parseFunc=void 0,this._onFlvKeyframe=void 0,this._eventEmitter=e,this._onFlvKeyframe=t,this._cache=new D,this._parseLen=C.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._result={list:[]}}var t=e.prototype;return t.reset=function(){this._parseLen=C.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result.list=[],this._result.callbackResult=void 0},t.processing=function(e){for(this._cache.put(new Uint8Array(e));this._cache.unreadLen>this._parseLen;)this._parseFunc();var t={list:this._result.list.splice(0),callbackResult:this._result.callbackResult};return this._result.callbackResult=void 0,t},t._parseFlvHead=function(){var e=this._cache.read(C.a.FLV_HEAD_LEN);e&&(70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._eventEmitter.emit(u.a.ERROR,{type:d.b.MUX_ERROR,details:d.a.DEMUX_ERROR,fatal:!0,info:{reason:"flv wrong head"}}),this._eventEmitter.emit(u.a.FLV_HEAD,{hasAudio:(4&e[4])>>>2,hasVideo:1&e[4]}),this._cache.skip(C.a.FLV_HEAD_LEN),this._parseLen=C.a.FLV_TAG_HEAD_LEN,this._parseFunc=this._parseFlvTagHead)},t._parseFlvTagHead=function(){this._tag=new C.b;var e=this._cache.read(C.a.FLV_TAG_HEAD_LEN);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._cache.skip(C.a.FLV_TAG_HEAD_LEN),this._tag.tagType===C.c.VIDEO?(this._parseFunc=this._detectKeyFrame,this._parseLen=C.a.AVC_KEY_FRAME_CHECK_LEN):(this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+C.a.FLV_TAG_SIZE_LEN))},t._detectKeyFrame=function(){var e=this._cache.read(2);if(e&&this._tag){var t=(240&e[0])>>>4,i=e[1];this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+C.a.FLV_TAG_SIZE_LEN,1===t&&1===i&&this._onFlvKeyframe&&(this._result.callbackResult=this._onFlvKeyframe(this._tag.timestamp),this._result.callbackResult&&(this._parseLen=C.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0))}},t._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==C.c.SCRIPT&&e.tagType!==C.c.AUDIO&&e.tagType!==C.c.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),e&&this._result.list.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=C.a.FLV_TAG_HEAD_LEN)},e}(),B="startLoadStream",P="loader-chunk-arrival",F="keyFrame",N=i(4);function U(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=new RegExp("^(http|https)://"),H=function(e){var t,i;function s(t,i){var s;(s=e.call(this)||this)._config=void 0,s._media=void 0,s._w=void 0,s._flv=void 0,s._eventEmitter=void 0,s._loader=void 0,s._loaderConf=void 0,s._loaderCallbacks=void 0,s._multirate=void 0,s._isContinuous=void 0,s._remuxId=void 0,s._baseTimeSec=0,s._tagDump=void 0,s._currentUrl=void 0,s._isAbr=!1,s._progressTime=0,s._src=void 0,s._audioCodec="",s._onWorkerEvent=function(e){var t=e.data;s._onEvent(t.event,t.data)},s._flvKeyframeCallback=function(e){return s._media.hasStreamTime||s._media.updateStreamTime(e/1e3,0),s._multirate?s._multirate.onKeyFrame(e):void 0},s._onEvent=function(e,t){switch(e){case u.a.FLV_HEAD:s._w?s._w.postMessage({cmd:N.a.FLV_HEAD,hasAudio:t.hasAudio,hasVideo:t.hasVideo}):s._flv&&s._flv.flvHead(t.hasAudio,t.hasVideo);break;case u.a.MEDIA_INFO:s.emit(u.a.MEDIA_INFO,t);break;case u.a.MP4_SEGMENT:var i=t;if(i.extra&&i.extra.remuxId!==s._remuxId)break;i.segments.forEach((function(e){"audio"===e.type&&e.startDTS>s._baseTimeSec&&s._media.updateStreamTime(e.streamDTS,e.startDTS)})),s.emit(u.a.MP4_SEGMENT,i);break;default:s.emit(e,t)}},s._onLoaderProgress=function(e,t){if(t instanceof ArrayBuffer){s._multirate&&s._multirate.onLoaderChunk(t.byteLength),s.emit(u.a.REPORT,{type:P,byteLength:t.byteLength,timeCost:performance.now()-s._progressTime||e.stats.requestStartTime,header:e.context.responseHeader}),s._progressTime=performance.now();var i=s._tagDump.processing(t);s._append(i.list,s._baseTimeSec,s._isContinuous),s._isContinuous=!0,i.callbackResult&&(s._tagDump&&s._tagDump.reset(),s._baseTimeSec=i.callbackResult.timestamp&&s._media.getLocalTime(i.callbackResult.timestamp/1e3)||0,s.emit(u.a.LEVEL_SWITCHING,{level:i.callbackResult.level,startSec:s._baseTimeSec,smooth:!0}),s._load(i.callbackResult.url,i.callbackResult.level))}},s._onLoaderAbort=function(){},s._onLoaderError=function(e){if(e.stats.fatalError){var t={type:d.b.NETWORK_ERROR,details:"timeout"===e.stats.errorMessage?d.a.LOAD_ERROR_TIMEOUT:d.a.LOAD_ERROR,fatal:!0,info:{url:e.context.url,httpStatusCode:e.stats.httpStatusCode,reason:e.stats.errorMessage}};s.emit(u.a.ERROR,t)}},s._onLoaderEnd=function(){s._w?s._w.postMessage({cmd:N.a.LOAD_END}):s._flv&&s._flv.end()},s._config=t,s._media=i,s._loaderConf={connectionTimeout:s._config.connectionTimeout,transmissionTimeout:s._config.transmissionTimeout,maxRetry:0,retryDelay:0,useFetch:!0},s._loaderCallbacks={onProgress:s._onLoaderProgress,onError:s._onLoaderError,onEnd:s._onLoaderEnd,onAbort:s._onLoaderAbort},s._isContinuous=!1,s._remuxId=1;var a=s._eventEmitter=new r.EventEmitter;return a.on(u.a.MEDIA_INFO,(function(e){s._onEvent(u.a.MEDIA_INFO,e)})),a.on(u.a.SCRIPT_PARSED,(function(e){s._onEvent(u.a.SCRIPT_PARSED,e)})),a.on(u.a.MANIFEST_PARSED,(function(e){s._onEvent(u.a.MANIFEST_PARSED,e)})),a.on(u.a.MP4_SEGMENT,(function(e){s._onEvent(u.a.MP4_SEGMENT,e)})),a.on(u.a.ERROR,(function(e){s._onEvent(u.a.ERROR,e)})),a.on(u.a.FLV_HEAD,(function(e){s._onEvent(u.a.FLV_HEAD,e)})),s._tagDump=new I(s._eventEmitter,s._flvKeyframeCallback),s._config.webWorker&&(n.b.i("LasMain","webWorker"),s._w=_()(9),s._w)?(s._w.addEventListener("message",s._onWorkerEvent),s._w.postMessage({cmd:N.a.INIT,config:s._config,data:{remuxId:s._remuxId}}),function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(s)):(s._flv=new A.a(a,s._config,{remuxId:s._remuxId}),s._flv.init(),s)}i=e,(t=s).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a,o,h,c=s.prototype;return c.init=function(e,t){if(void 0===t&&(t=""),this._src=e,this._audioCodec=t,"string"==typeof e&&!V.test(e))try{this._src=JSON.parse(e)}catch(e){return void this.emit(u.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.MANIFEST_ERROR,fatal:!0,info:{reason:"manifest parse error"}})}this._src?(v.verify(this._src)&&(this._isAbr=!0),this._isAbr&&!this._multirate&&(this._multirate=new M(this._eventEmitter,this._config,this._media,this._src),this._multirate.init())):this.emit(u.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.MANIFEST_ERROR,fatal:!0,info:{reason:"src empty"}})},c.load=function(){var e=this._multirate;if(e){var t=e.levels[e.currentLevel];t?this._load(f(t.url,this._config.defaultLiveDelay),e.currentLevel):this.emit(u.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.MANIFEST_ERROR,fatal:!0,info:{reason:"manifest parse error"}})}else this._load(this._src)},c.destroy=function(){this._destroyLoader(),this._w&&(this._w.postMessage({cmd:N.a.DESTROY}),this._w.removeEventListener("message",this._onWorkerEvent),this._w.terminate()),this._flv&&(this._flv.destroy(),this._flv=void 0),this._multirate&&this._multirate.destory();var e=this._eventEmitter;e&&e.removeAllListeners()},c._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},c._load=function(e,t){void 0===t&&(t=0),this._destroyLoader(),this._multirate&&this._multirate.onLevelLoad(t),this._currentUrl=e;var i=this.levels[t];i&&this._updateCodecs(this._audioCodec||i.audioCodec,i.videoCodec),this.emit(u.a.REPORT,{type:B,url:e,sync:this._baseTimeSec,index:t,bitrate:i?i.bitrate:0}),this._loader||(this._loader=new b);var r={url:e,progress:!0,responseType:"arraybuffer",credentials:this._config.credentials};this._loader instanceof b&&this._loader.load(r,this._loaderCallbacks,this._loaderConf)},c._append=function(e,t,i){this._w?this._w.postMessage({cmd:N.a.APPEND_DATA,tags:e,timeOffset:t||0,isContinuous:i}):this._flv&&this._flv.append(e,t||0,i)},c._updateCodecs=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this._w?this._w.postMessage({cmd:N.a.SET_CODECS,audioCodec:e,videoCodec:t}):this._flv&&this._flv.setCodecs(e,t)},c._refreshRemuxId=function(){this._remuxId++;var e={remuxId:this._remuxId};this._w?this._w.postMessage({cmd:N.a.SET_EXTRA,data:e}):this._flv&&this._flv.setExtra(e)},a=s,(o=[{key:"autoLevelEnabled",get:function(){return!!this._multirate&&this._multirate.autoLevelEnabled}},{key:"levels",get:function(){return this._multirate?this._multirate.levels:[]}},{key:"nextLevel",get:function(){return this._multirate?this._multirate.nextLevel:0},set:function(e){var t=this._multirate;t&&(t.nextLevel=e)}},{key:"currentLevel",get:function(){return this._multirate?this._multirate.currentLevel:0},set:function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var r=t.levels[t.currentLevel];i&&r&&(this._currentUrl=f(r.url,this._config.defaultLiveDelay),this._refreshRemuxId(),this._isContinuous=!1,this._tagDump&&this._tagDump.reset(),this._baseTimeSec=this._media.currentTime,this.emit(u.a.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1}),this._load(this._currentUrl,t.currentLevel))}}}])&&U(a.prototype,o),h&&U(a,h),s}(r.EventEmitter);function j(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(){this._video=void 0,this._mse=void 0,this._streamTime=0,this._localTime=0}var t,i,r,n=e.prototype;return n.reset=function(){this._streamTime=0,this._localTime=0},n.attachVideo=function(e){this._video=e},n.attachMSE=function(e){this._mse=e},n.isTimeinBuffered=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},n.bufferedSec=function(){return this._video&&this._video.buffered.length>0?Math.max(0,this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime):0},n.bufferedSecByType=function(e){if(this._mse&&this._video&&this._mse.bufferedEndByType(e)>0)return this._mse.bufferedEndByType(e)-this._video.currentTime;return 0},n.mseBufferedSecByType=function(e){return this._mse?this._mse.bufferedByType(e):{start:0,end:0}},n.bufferSliceNumByType=function(e){return this._mse?this._mse.bufferSliceNumByType(e):0},n.pendingNum=function(){return this._mse?this._mse.pendingNum():0},n.pendingSecByType=function(e){return this._mse?this._mse.pendingSecByType(e):0},n.currentBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r<=e&&e<n)return{start:r,end:n}}},n.nextBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r>e)return{start:r,end:n}}},n.updateStreamTime=function(e,t){this._streamTime=e,this._localTime=t},n.getLocalTime=function(e){if(this._streamTime)return e-this._streamTime+this._localTime},t=e,(i=[{key:"hasStreamTime",get:function(){return!!this._streamTime}},{key:"video",get:function(){return this._video}},{key:"mse",get:function(){return this._mse}},{key:"mseReadyState",get:function(){return this._mse?this._mse.readyState:"closed"}},{key:"videoReadyState",get:function(){return this._video?this._video.readyState:0}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0}}])&&j(t.prototype,i),r&&j(t,r),e}();function z(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).tag="MSE",i._config=void 0,i.video=void 0,i._sourceBuffer=void 0,i._mediaSource=null,i._mimeCodec=void 0,i._cleanUpTask=void 0,i._appendQueue=void 0,i._hasVideo=void 0,i._hasAudio=void 0,i._endOfData=!1,i._appendEnabled=void 0,i._duration=null,i._appendError=0,i._appendBufferError=!1,i._sbHandler={},i._onSourceOpen=function(){n.b.i(i.tag,"MediaSource onSourceOpen"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._checkSourceBuffer(),i.refresh(),i.emit("source_open"))},i._onSourceEnded=function(){n.b.i(i.tag,"MediaSource onSourceEnded")},i._onSourceClose=function(){n.b.i(i.tag,"MediaSource onSourceClose"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._mediaSource.removeEventListener("sourceended",i._onSourceEnded),i._mediaSource.removeEventListener("sourceclose",i._onSourceClose))},i._onSourceBufferUpdateEnd=function(e){i._update(e),i._endOfData&&i._endOfStream(),i.emit("updateend")},i._onSourceBufferError=function(e){n.b.e(i.tag,"SourceBuffer Error: "+e),i.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.SOURCEBUFFER_ERROR,fatal:!0,info:{reason:"source buffer error"}})},i._config=t,i._hasVideo=!1,i._hasAudio=!1,i._appendQueue={video:[],audio:[],audiovideo:[]},i._sourceBuffer={},i._cleanUpTask={video:[],audio:[],audiovideo:[]},i._mimeCodec={},i._appendEnabled=!0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s,a,o,h=r.prototype;return h.attach=function(e){var t=this;this.video=e;var i=window.MediaSource||window.WebKitMediaSource;if(i){var r=this._mediaSource=new i;this.video.src=URL.createObjectURL(r),this.video.load(),r.addEventListener("sourceopen",this._onSourceOpen),r.addEventListener("sourceended",this._onSourceEnded),r.addEventListener("sourceclose",this._onSourceClose)}else setTimeout((function(){t.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.MEDIASOURCE_ERROR,fatal:!0,info:{reason:"MediaSource is not support"}})}),0)},h.mediaInit=function(e){if((this._hasAudio!==e.hasAudio||this._hasVideo!==e.hasVideo||!!e.audiovideo!=!!this._mimeCodec.audiovideo)&&this.video&&this.hasSourceBuffer()){for(var t in n.b.i(this.tag,"trackInfo rebuild mse"),this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend));this._sourceBuffer={},this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._mediaSource.removeEventListener("sourceended",this._onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this._onSourceClose)),this._mimeCodec={},this.attach(this.video)}e.audiovideo?this._mimeCodec.audiovideo='video/mp4; codecs="'+e.codec+'"':(e.hasAudio&&e.audioCodec&&(this._mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"'),e.hasVideo&&e.videoCodec&&(this._mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"')),this._hasAudio=this._hasAudio||e.hasAudio,this._hasVideo=this._hasVideo||e.hasVideo,this._checkSourceBuffer()},h.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},h.mediaSegment=function(e){var t=this;e.forEach((function(e){var i=e.type;t._appendQueue[i].push(e),t._sourceBuffer[i]&&t._update(i)}))},h.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},h.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},h.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},h.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.endDTS-t.startDTS}),0):0},h.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},h._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(this._mimeCodec.audiovideo&&(e=1,t=1),n.b.v(this.tag,"checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&this._addSourceBuffer(i)},h._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]))}catch(e){return n.b.e(this.tag,e),void this.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.ADDSOURCEBUFFER_ERROR,fatal:!0,info:{reason:e.message}})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&(this._mediaSource.duration=this._duration)}},h._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},h._doAppend=function(e){if(this._hasPendingData()){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,info:{reason:"bufferfull"}})));if(this._appendQueue[e].length>0&&this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t)}}},h._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var r=this._cleanUpTask[e],n=this._sourceBuffer[e].buffered;if(n.length>=1&&i-n.start(0)>=10){var s=i-5;if(r.length&&0===r[r.length-1].start&&r[r.length-1].end===s)return;r.push({start:0,end:s})}}}},h._cleanUpRange=function(e,t){var i=this._sourceBuffer[e];if(i){if(i.updating)return!1;try{for(var r=0;r<i.buffered.length;r++){var n=i.buffered.end(r),s=Math.max(0,t.start),a=Math.min(n,t.end);if(a>s&&(i.remove(s,a),this.emit("remove"),r<i.buffered.length-1))return!1}}catch(e){}}return!0},h._appendBuffer=function(e){if(e&&this._sourceBuffer[e.type]&&this.video&&!this.video.error)try{this._sourceBuffer[e.type].appendBuffer(e.payload.buffer)}catch(s){if(n.b.w(this.tag,s.code,s),22!==s.code)this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,info:{reason:s.message}})):this._appendQueue[e.type].unshift(e);else{var t=this.video;this._config;this._appendEnabled=!1,this._appendQueue[e.type].unshift(e);var i=t.buffered.end(t.buffered.length-1)-t.currentTime,r=t.currentTime-t.buffered.start(0);i<30?(this._calculateRemoveRange(e.type),this.hasCleanUpTask(e.type)&&this._cleanUp(e.type)):r<10&&this.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,info:{reason:"buffer full, append error"}}),n.b.i(this.tag,"mse bufferfull"),this.emit("bufferFull")}}},h.flush=function(e,t,i){var r=0,n=Number.POSITIVE_INFINITY;for(var s in this._endOfData=!1,this._sourceBuffer){if(!i||i===s)if(this._sourceBuffer[s]){if(e){r=Math.max(r,e);for(var a=this._appendQueue[s].length-1;a>=0&&(!this._appendQueue[s][a].startPTS||this._appendQueue[s][a].startPTS>=e);a--)this._appendQueue[s].pop()}else this._appendQueue[s]=[];t&&(n=Math.min(n,t)),this._cleanUpTask[s].push({start:r,end:n}),this._cleanUp(s)}}this._appendEnabled=!0},h.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},h.getAppendEnabled=function(){return this._appendEnabled},h.endOfData=function(){this._endOfData=!0,this._hasPendingData()||this._endOfStream()},h.ended=function(){return this._endOfData},h._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{e.endOfStream()}catch(e){n.b.e(this.tag,e),this.emit(u.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.ENDOFSTREAM_ERROR,fatal:!0,info:{reason:e.message}})}}},h.destroy=function(){if(this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},h.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},h.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},h._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.payload&&t.payload.byteLength?e+t.payload.byteLength:e}),0);return e},h.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){var i=t.endDTS-t.startDTS;return i?e+i:e}),0)):e}),0):0},h._update=function(e){this.hasCleanUpTask(e)&&this._cleanUp(e),this._doAppend(e)},h._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0];if(!this._cleanUpRange(e,i))return;t.shift()}this.refresh()},s=r,(a=[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}}])&&z(s.prototype,a),o&&z(s,o),r}(r.EventEmitter);var Q=window.performance,G=function(){function e(){this.tag="fps",this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._lastTime=0,this._decoded=0,this._dropped=0}var t=e.prototype;return t.attachMedia=function(e){var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"==typeof t.getVideoPlaybackQuality)},t.destory=function(){},t.reset=function(){this._lastTime=Q.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0;var e=this._video;if(e)try{if(this._isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this._lastDecodedFrames=t.totalVideoFrames,this._lastDroppedFrames=t.droppedVideoFrames}else this._lastDecodedFrames=e.webkitDecodedFrameCount,this._lastDroppedFrames=e.webkitDroppedFrameCount}catch(e){return}},t.getInfo=function(){var e=this._video,t=Q.now(),i=0,r=0;if(e)if(this._isVideoPlaybackQualityAvailable){var n=e.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else i=e.webkitDecodedFrameCount||0,r=e.webkitDroppedFrameCount||0;if(i){i<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var s=t-this._lastTime,a=r-this._lastDroppedFrames,o=i-this._lastDecodedFrames,d=0,u=0;return this._lastTime&&(d=parseFloat((1e3*a/s).toFixed(2)),u=parseFloat((1e3*o/s).toFixed(2))),this._decoded=this._decoded+=o,this._dropped=this._dropped+=a,this._lastTime=t,this._lastDroppedFrames=r,this._lastDecodedFrames=i,{decoded:this._decoded,dropped:this._dropped,decodedFPS:u,droppedFPS:d}}this._lastTime=t},e}();function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function X(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Z=function(){function e(){this._qos=void 0,this.reset()}var t,i,r,n=e.prototype;return n.reset=function(){this._qos={traffic:0,streams:[],download:[]}},n.onKeyFrame=function(){this._qos.streams[this._qos.streams.length-1].keyFrame++},n.onStreamOpen=function(e,t,i,r){this._qos.streams.length>10&&this._qos.streams.shift(),this._qos.streams.push({index:e,startPos:t,url:i,bitrate:r,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,segments:{}})},n.onMediaInfo=function(e){var t=this.loadingInfo;t&&(t.mediaInfo=K({},e))},n.onDataReceive=function(e){this._qos.traffic+=e.byteLength;var t=this._qos.download;t.length>200&&t.pop(),t.unshift(e);var i=this._qos.streams[this._qos.streams.length-1];i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost},n.onMediaSegment=function(e){var t=this._qos,i=t.streams[t.streams.length-1],r=i.segments[e.type]||[];i.segments[e.type]=r,r.push({duration:1e3*(e.endDTS-e.startDTS),dts:1e3*e.startDTS,len:e.payload.byteLength}),r.length>100&&r.shift();for(var n=0,s=0,a=0;a<r.length;a++)s+=r[a].len,n+=r[a].duration;n>0&&("video"===e.type?i.videoDataRate=Math.round(8*s/n):"audio"===e.type&&(i.audioDataRate=Math.round(8*s/n)))},n.getInfoByTime=function(e){for(var t=this._qos.streams.length-1;t>=0;t--)if(this._qos.streams[t].startPos<e)return this._qos.streams[t];return null},n.updateStartPos=function(e){this._qos.streams.length&&(this._qos.streams[this._qos.streams.length-1].startPos=e)},t=e,(i=[{key:"loadingInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1]:null}},{key:"downloadSpeed",get:function(){for(var e=this._qos,t=performance.now(),i=0,r=0,n=0;n<e.download.length&&e.download[n].ts>t-1e3;n++)i+=e.download[n].byteLength,r+=e.download[n].timeCost;return Math.round(i/r*1e3)||0}},{key:"mediaInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].mediaInfo:null}},{key:"videoDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].videoDataRate:0}},{key:"audioDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].audioDataRate:0}},{key:"bitrate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].bitrate:0}},{key:"traffic",get:function(){return this._qos.traffic}},{key:"data",get:function(){return this._qos}}])&&X(t.prototype,i),r&&X(t,r),e}();function Y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this)._media=void 0,i._playbackQuality=void 0,i._data=void 0,i._playing=!1,i._sm=void 0,i._hbTimer=void 0,i._heartbeat=function(){i._refresh();var e=i._data,t=i._sm,r={totalReceive:t.traffic,speed:t.downloadSpeed,videoDataRate:t.videoDataRate,audioDataRate:t.audioDataRate,decodedFPS:e.decodedFPS,droppedFPS:e.droppedFPS,decodedFrames:e.decodedFrames,droppedFrames:e.droppedFrames};i.emit(u.a.HEARTBEAT,r)},i._sm=new Z,i._media=t,i.reset(),i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,s,a,o=r.prototype;return o.reset=function(){this._data={decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,loadStartTime:0,firstFrameTime:0,blockDuration:0,blockCount:0,downloadedBytes:0},this._sm.reset(),this._playbackQuality&&this._playbackQuality.reset(),this._refresh()},o.onReport=function(e){e.ts=e.ts||performance.now();var t=this._data;switch(e.type){case P:t.downloadedBytes+=e.byteLength,this._sm.onDataReceive(e);break;case B:this._sm.onStreamOpen(e.index||0,e.sync,e.url,e.bitrate);break;case F:this._sm.onKeyFrame()}},o.destroy=function(){this._playbackQuality&&(this._playbackQuality.destory(),this._playbackQuality=void 0),this._stopHeartbeat()},o.onLoad=function(){this._startHeartbeat(),this._media.video&&(this._playbackQuality=new G,this._playbackQuality.attachMedia(this._media.video))},o.onSegmentInit=function(e){this._sm.onMediaInfo(e)},o.onLoadeddata=function(){this._onFirstFrame(),this._waitingEnd()},o.onCanplay=function(){this._onFirstFrame(),this._waitingEnd()},o.onPlaying=function(){this._playing=!0,this._waitingEnd()},o.onEnd=function(){this._waitingEnd()},o.onWaiting=function(e){this._playing&&this._data.firstFrameTime&&e&&this._waitingStart()},o.onStopLoad=function(){this._stopHeartbeat()},o.onSegment=function(e){var t=this;e.segments.forEach((function(e){t._sm.onMediaSegment(e)}))},o._refresh=function(){var e;this._playbackQuality&&(e=this._playbackQuality.getInfo());var t=this._data;e?(t.decodedFPS=e.decodedFPS,t.droppedFPS=e.droppedFPS,t.droppedFrames=e.dropped,t.decodedFrames=e.decoded):t.decodedFPS=t.droppedFPS=t.droppedFrames=t.decodedFrames=0},o._onFirstFrame=function(){this._data.firstFrameTime||(this._data.firstFrameTime=performance.now())},o._waitingStart=function(){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=this._data.bufferingStartMS||performance.now())},o._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.blockDuration+=performance.now()-this._data.bufferingStartMS),this._data.bufferingStartMS=null},o._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat,1e3))},o._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=void 0)},n=r,(s=[{key:"data",get:function(){return this._data}}])&&Y(n.prototype,s),a&&Y(n,a),r}(r.EventEmitter),$=i(6);var ee=function(){function e(e,t){this.tag="PlaybackRateManager",this._media=void 0,this._config=void 0,this._interval=0,this._timer=void 0,this._media=e,this._config=t}var t=e.prototype;return t.start=function(){this._interval=this._interval||this._config.startDelay||this._config.interval||5,this._tick(),this._interval=this._config.interval||1},t.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},t.destroy=function(){this._timer&&(clearTimeout(this._timer),this._timer=0)},t._tick=function(){var e=this;this._timer||(this._timer=setTimeout((function(){e._media.video&&e._nextPlayBackRate(e._media.bufferedSec(),e._media.video),e._timer=0,e._tick()}),1e3*this._interval))},t._nextPlayBackRate=function(e,t){var i=1,r=this._config.rule,s=0;for(s=0;s<r.length&&!(t.playbackRate>=r[s].rate);s++);var a=s<r.length-1?r[s+1]:null,o=s>0?r[s-1]:null;i=r[s].rate,o&&e>o.lower&&(i=o.rate),a&&e<a.upper&&(i=a.rate),t.playbackRate!==i&&(n.b.i(this.tag,"auto change playback rate from "+t.playbackRate+" to "+i),t.playbackRate=i)},e}();function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ne(e,t,i){return t&&re(e.prototype,t),i&&re(e,i),e}var se;!function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT"}(se||(se={}));var ae=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).tag="las",i._config=void 0,i._src=void 0,i._video=void 0,i._mse=void 0,i._lasMain=void 0,i._stat=se.INIT,i._audioCodecSwap=!1,i._error=void 0,i._audioCodec="",i._recoverMediaErrorTime=0,i._mainTimer=void 0,i._media=void 0,i._nextLevel=[],i._mediaInfo=void 0,i._loadStopped=!1,i._seekOnUpdateEnd=!1,i._playingLevel=void 0,i._startLevel=void 0,i._monitor=void 0,i._playbackRateManager=void 0,i._onVideoLoadeddata=function(){n.b.i(i.tag,"loadeddata"),i._monitor.onLoadeddata()},i._onVideoCanplay=function(){n.b.v(i.tag,"canplay "+!!i._stat),i._monitor.onCanplay(),i._video&&i._stat!==se.NONE&&(i._stat=se.NONE,i._checkLevelChange(),i._video.paused||i._onVideoPlaying())},i._onVideoWaiting=function(){if(i._video){i._stat=i._stat||se.WAITING;var e=!i._video.seeking&&i._stat===se.WAITING;e&&n.b.i(i.tag,"waiting currentTime:",i._video.currentTime),i._monitor.onWaiting(e)}},i._onVideoPlaying=function(){n.b.i(i.tag,"playing"),i._error||(i._stat=se.NONE,i._monitor.onPlaying())},i._onVideoEnded=function(){i._monitor.onEnd(),i._mse&&i._mse.flush()},i._onVideoError=function(e){if(n.b.e(i.tag,"video error",e),!i._error){if(i._config.autoRecoverMedia){var t=performance.now();if((!i._recoverMediaErrorTime||t-i._recoverMediaErrorTime>3e3)&&i._recoverSwapRemuxType())return void(i._recoverMediaErrorTime=t);if(i._recoverSwapAudioCodec())return}var r="video error";i._video&&i._video.error&&(r+=" code:"+i._video.error.code+" message:"+i._video.error.message),i._onError({type:d.b.MEDIA_ERROR,details:d.a.VIDEO_ERROR,fatal:!0,info:{reason:r}})}},i._resetMSE=function(){i._seekOnUpdateEnd=!1,i._video&&(n.b.i(i.tag,"rebuild mse"),URL.revokeObjectURL(i._video.src),i._video.src="",i._video.removeAttribute("src"),i._destroyMSE(),i._initMSE())},i._mainLoop=function(){var e=i._video;if(e&&(i._stat===se.WAITING&&!e.seeking||i._stat===se.INIT||i._stat===se.SEEK||i._stat===se.SELECT_BITRATE)&&i._mse&&!i._mse.hasCleanUpTask()&&!e.ended){var t=e.currentTime,r=i._media.currentBuffer(t),s=void 0;if(!r||r.end-t<1){var a=i._media.nextBuffer(t);a&&(n.b.i(i.tag,"try fix block-A"),s=a.start)}else e.buffered.length>1&&r.end-t>1&&(n.b.i(i.tag,"try fix block-B"),s=r.start);s&&(s+=$.a.isSafari?.3:.001,i._internalSeek(s),n.b.i(i.tag,"jump to "+s))}i._nextLevel.length&&i._checkLevelChange()},i.off||(i.off=i.removeListener),i._config=o.processConfig(t),i._media=new q,i._config?r.isSupport()?(i._mainTimer=null,i._stat=se.INIT,i._startMainTimer(),i._initMonitor(),i._config.autoPlaybackRateConf&&(i._playbackRateManager=new ee(i._media,i._config.autoPlaybackRateConf)),n.b.i(i.tag,r.version,i._config),i):(setTimeout((function(){i._onError({type:d.b.OTHER_ERROR,details:d.a.UNSUPPORTED,fatal:!0,info:{reason:"unsupported"}})}),0),ie(i)):(setTimeout((function(){i._onError({type:d.b.OTHER_ERROR,details:d.a.CONFIG_ERROR,fatal:!0,info:{reason:"config data error"}})}),0),ie(i))}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.isSupport=function(){return e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,n=m.isSupport()||y.isSupportChunk()===p.MOZ_CHUNK,i&&r&&n;var e,t,i,r,n},ne(r,null,[{key:"version",get:function(){return"1.0.5"}},{key:"Events",get:function(){return u.a}},{key:"ErrorTypes",get:function(){return d.b}},{key:"ErrorDetails",get:function(){return d.a}}]);var s=r.prototype;return s.attachMedia=function(e){this._video=e,this._media.attachVideo(this._video),this._initMSE(),this._bindVideoEvents()},s.load=function(e){void 0===e&&(e=void 0),this._video||this._onError({type:d.b.OTHER_ERROR,details:d.a.NO_VIDEO,fatal:!0,info:{reason:"no video attached"}}),this._playingLevel=void 0,this._monitor.reset(),e&&(this._src=e),this._load()},s.resume=function(){n.b.i(this.tag,"call resume"),this._loadStopped&&(this._loadStopped=!1,this._load()),this._video&&this._video.paused&&this._video.play()},s.destroy=function(){this._playbackRateManager&&this._playbackRateManager.destroy(),this._stopMonitor(),this._stopMainTimer(),this._unbindVideoEvents(),this._stopVideo(),this.removeAllListeners()},s.refresh=function(e){void 0===e&&(e=!1),n.b.i(this.tag,"call refresh"),(this._config.autoRecoverMedia||this._error!==d.a.VIDEO_ERROR||!this._recoverSwapRemuxType()&&!this._recoverSwapAudioCodec())&&this._reload(e),this._error=void 0},s.stopLoad=function(){n.b.i(this.tag,"call stopLoad"),this._lasMain&&(this._destroyLasMain(),this._mse.endOfData(),this._loadStopped=!0,this._monitor.onStopLoad()),this._playbackRateManager&&this._playbackRateManager.stop()},s.getMediaInfo=function(){return te({},this._mediaInfo)},s._reload=function(e){void 0===e&&(e=!1),this._lasMain&&this._mse||this._error?(this._lasMain&&(this._startLevel=this._lasMain.currentLevel),this._nextLevel=[],e&&this._mse?(this._mse.flush(),this._internalSeek(0),this._seekOnUpdateEnd=!0):(this._stopVideo(),this._initMSE()),this._destroyLasMain(),this._initLasMain(),this._lasMain&&this._lasMain.load()):n.b.v(this.tag,"transmuxer & mediaSource not ready")},s._bindVideoEvents=function(){this._video&&(this._video.addEventListener("loadeddata",this._onVideoLoadeddata),this._video.addEventListener("canplay",this._onVideoCanplay),this._video.addEventListener("waiting",this._onVideoWaiting),this._video.addEventListener("playing",this._onVideoPlaying),this._video.addEventListener("ended",this._onVideoEnded),this._video.addEventListener("error",this._onVideoError))},s._unbindVideoEvents=function(){this._video&&(this._video.removeEventListener("loadeddata",this._onVideoLoadeddata),this._video.removeEventListener("canplay",this._onVideoCanplay),this._video.removeEventListener("waiting",this._onVideoWaiting),this._video.removeEventListener("playing",this._onVideoPlaying),this._video.removeEventListener("ended",this._onVideoEnded),this._video.removeEventListener("error",this._onVideoError))},s._initMSE=function(){var e=this;if(this._video){var t=this._video;this._mse=new W(this._config),this._mse.attach(t),this._media.attachMSE(this._mse),this._mse.on(u.a.ERROR,(function(t){e._onError(t)})),this._mse.on("updateend",(function(){e._seekOnUpdateEnd&&t.buffered.length&&(n.b.i(e.tag,"seek on updateend"),e._internalSeek(t.buffered.start(0)),e._seekOnUpdateEnd=!1)})),this._mse.on("resetDone",(function(){e._seekOnUpdateEnd=!0}))}},s._destroyMSE=function(){this._mse&&(this._mse.removeAllListeners(),this._mse.destroy())},s._load=function(){this._loadStopped=!1,this._error=void 0,this._stat=se.INIT,this._nextLevel=[],this._media.reset(),this._monitor.onLoad(),this._lasMain&&this._destroyLasMain(),(this._mse.hasSourceBuffer()||this._video&&this._video.error)&&this._resetMSE(),this._initLasMain(),this._lasMain&&this._lasMain.load(),this._config.autoPlaybackRate&&this._playbackRateManager&&this._playbackRateManager.start()},s._verifyLevel=function(e){return!(!(this._lasMain&&this._lasMain.levels.length>0&&e<this._lasMain.levels.length&&e>=-1&&this._video)||this._video.ended)},s._initLasMain=function(){this._lasMain=new H(this._config,this._media),this._bindLasMainEvent(this._lasMain),this._lasMain.init(this._src,this._audioCodec)},s._destroyLasMain=function(){this._lasMain&&(this._lasMain.removeAllListeners(),this._lasMain.destroy(),this._lasMain=void 0)},s._bindLasMainEvent=function(e){var t=this,i=this._mse;e.on(u.a.MP4_SEGMENT,(function(e){i&&i.mediaSegment(e.segments),t._monitor&&t._monitor.onSegment(e)})),e.on(u.a.MEDIA_INFO,(function(e){var r=te({},e);t._monitor.onSegmentInit(r),t.emit(u.a.MEDIA_INFO,r),t._mediaInfo=r,t._audioCodec=e.defaultAudioCodec||e.audioCodec,i&&i.mediaInit(r)})),e.on(u.a.ERROR,(function(e){t._onError(e)})),e.on(u.a.LOAD_END,(function(){i&&i.endOfData(),t.emit(u.a.LOAD_END)})),e.on(u.a.LEVEL_SWITCH_FAILED,(function(e){t.emit(u.a.LEVEL_SWITCH_FAILED,e)})),e.on(u.a.LEVEL_SWITCHING,(function(e){!e.smooth&&t._mse&&t._mse.flush(),t.emit(u.a.LEVEL_SWITCHING,{level:e.level}),t._nextLevel=t._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(t){return t.startSec<e.startSec})),t._nextLevel.push(e)})),e.on(u.a.SCRIPT_PARSED,(function(e){t.emit(u.a.SCRIPT_PARSED,e)})),e.on(u.a.MANIFEST_PARSED,(function(i){"number"!=typeof t._playingLevel?("number"==typeof t._startLevel&&(e.currentLevel=t._startLevel),i=te({levels:t.levels.slice(0),currentLevel:t.currentLevel},i),t._playingLevel=e.currentLevel,n.b.i(t.tag,u.a.MANIFEST_PARSED,i),t.emit(u.a.MANIFEST_PARSED,i)):e.currentLevel=t._playingLevel})),e.on(u.a.REPORT,(function(e){t._monitor&&t._monitor.onReport(e)}))},s._internalSeek=function(e){this._video&&(this._video.currentTime=e)},s._onError=function(e){n.b.i(this.tag,"on error "+JSON.stringify(e)),!e.info.url&&this.levels&&this.levels[this.currentLevel]&&(e.info.url=this.levels[this.currentLevel].url),e.fatal&&(this.stopLoad(),this._stopMainTimer(),(e.details===d.a.VIDEO_ERROR||this._video&&this._video.error)&&this._destroyMSE(),this._error||(this._error=e.details,this.emit(u.a.ERROR,e)))},s._startMainTimer=function(){null===this._mainTimer&&(this._mainTimer=setInterval(this._mainLoop,200))},s._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=null)},s._checkLevelChange=function(){var e=this._nextLevel[0];this._video&&e&&this._video.currentTime>=e.startSec&&this._media.isTimeinBuffered(this._video.currentTime)&&(this.emit(u.a.LEVEL_SWITCHED,{level:e.level}),this._playingLevel=e.level,this._nextLevel.shift())},s._stopVideo=function(){this._video&&(URL.revokeObjectURL(this._video.src),this._video.src="",this._video.removeAttribute("src"),this._destroyLasMain(),this._destroyMSE())},s._initMonitor=function(){var e=this;this._monitor||(this._monitor=new J(this._media),this._monitor.on(u.a.HEARTBEAT,(function(t){e.emit(u.a.HEARTBEAT,t)})))},s._stopMonitor=function(){this._monitor&&(this._monitor.destroy(),this._monitor.removeAllListeners())},s._recoverSwapRemuxType=function(){var e=this._config.gopRemux;return this._config.gopRemux=!0,e!==this._config.gopRemux&&(n.b.i(this.tag,"recover swap remux type"),this._reload(),!0)},s._recoverSwapAudioCodec=function(){return!(this._audioCodecSwap||!this._audioCodec)&&(-1!==this._audioCodec.indexOf("mp4a.40.5")?this._audioCodec="mp4a.40.2":this._audioCodec="mp4a.40.5",this._audioCodecSwap=!0,n.b.i(this.tag,"recover swap audio codec"),this._reload(),!0)},ne(r,[{key:"autoLevelEnabled",get:function(){return!!this._lasMain&&this._lasMain.autoLevelEnabled}},{key:"levels",get:function(){return this._lasMain&&this._lasMain.levels.slice(0),[]}},{key:"nextLevel",get:function(){return this._lasMain?this._lasMain.nextLevel:0},set:function(e){this._verifyLevel(e)&&this._lasMain?this._lasMain.nextLevel=e:this.emit(u.a.LEVEL_SWITCH_FAILED,{level:e})}},{key:"currentLevel",get:function(){return this._lasMain?this._lasMain.currentLevel:0},set:function(e){this._verifyLevel(e)&&this._lasMain?-1===e?this._lasMain.nextLevel=e:(this._stat=se.SELECT_BITRATE,this._seekOnUpdateEnd=!0,this._mse&&this._mse.flush(),this._lasMain.currentLevel=e):this.emit(u.a.LEVEL_SWITCH_FAILED,{level:e})}},{key:"startLevel",get:function(){return void 0===this._startLevel?-1:this._startLevel},set:function(e){this._startLevel=e}},{key:"monitorData",get:function(){if(this._monitor)return this._monitor.data}}]),r}(r.EventEmitter)}]).default}));
//# sourceMappingURL=index.min.js.map